\documentclass{article}

% packages
  % basic stuff for rendering math
  \usepackage[letterpaper, top=1in, bottom=1in, left=1in, right=1in]{geometry}
  \usepackage[utf8]{inputenc}
  \usepackage[english]{babel}
  \usepackage{amsmath} 
  \usepackage{amssymb}
  % \usepackage{amsthm}

  % extra math symbols and utilities
  \usepackage{mathtools}        % for extra stuff like \coloneqq
  \usepackage{mathrsfs}         % for extra stuff like \mathsrc{}
  \usepackage{centernot}        % for the centernot arrow 
  \usepackage{bm}               % for better boldsymbol/mathbf 
  \usepackage{enumitem}         % better control over enumerate, enumerate
  \usepackage{hyperref}         % for hypertext linking
  \usepackage{fancyvrb}          % for better verbatim environments
  \usepackage{newverbs}         % for texttt{}
  \usepackage{xcolor}           % for colored text 
  \usepackage{listings}         % to include code
  \usepackage{lstautogobble}    % helper package for code
  \usepackage{parcolumns}       % for side by side columns for two column code
  \usepackage{xfrac}
  \usepackage{bbm, dsfont}
  % page layout
  \usepackage{fancyhdr}         % for headers and footers 
  \usepackage{lastpage}         % to include last page number in footer 
  \usepackage{parskip}          % for no indentation and space between paragraphs    
  \usepackage[T1]{fontenc}      % to include \textbackslash
  \usepackage{footnote}
  \usepackage{etoolbox}
  \usepackage{anyfontsize}

  % for custom environments
  \usepackage{tcolorbox}        % for better colored boxes in custom environments
  \tcbuselibrary{breakable}     % to allow tcolorboxes to break across pages

  % figures
  \usepackage{pgfplots}
  \pgfplotsset{compat=1.18}
  \usepackage{float}            % for [H] figure placement
  \usepackage{tikz}
  \usepackage{tikz-cd}
  \usepackage{circuitikz}
  \usetikzlibrary{arrows}
  \usetikzlibrary{positioning}
  \usetikzlibrary{calc}
  \usepackage{graphicx}
  \usepackage{caption} 
  \usepackage{subcaption}
  \captionsetup{font=small}
  \usepackage{booktabs} % For formal tables

  % for tabular stuff 
  \usepackage{dcolumn}

  \usepackage[nottoc]{tocbibind}
  \pdfsuppresswarningpagegroup=1
  \hfuzz=5.002pt                % ignore overfull hbox badness warnings below this limit

% New and replaced operators
  \DeclareMathOperator{\Tr}{Tr}
  \DeclareMathOperator{\Sym}{Sym}
  \DeclareMathOperator{\Span}{span}
  \DeclareMathOperator{\std}{std}
  \DeclareMathOperator{\Cov}{Cov}
  \DeclareMathOperator{\Var}{Var}
  \DeclareMathOperator{\Corr}{Corr}
  \DeclareMathOperator{\pos}{pos}
  \DeclareMathOperator{\MV}{MV}
  \DeclareMathOperator{\V}{V}
  \DeclareMathOperator*{\argmin}{\arg\!\min}
  \DeclareMathOperator*{\argmax}{\arg\!\max}
  \newcommand{\ket}[1]{\ensuremath{\left|#1\right\rangle}}
  \newcommand{\bra}[1]{\ensuremath{\left\langle#1\right|}}
  \newcommand{\braket}[2]{\langle #1 | #2 \rangle}
  \newcommand{\qed}{\hfill$\blacksquare$}     % I like QED squares to be black

% Custom Environments
  \newtcolorbox[auto counter, number within=section]{question}[1][]
  {
    colframe = orange!25,
    colback  = orange!10,
    coltitle = orange!20!black,  
    breakable, 
    title = \textbf{Question \thetcbcounter ~(#1)}
  }

  \newtcolorbox[auto counter, number within=section]{exercise}[1][]
  {
    colframe = teal!25,
    colback  = teal!10,
    coltitle = teal!20!black,  
    breakable, 
    title = \textbf{Exercise \thetcbcounter ~(#1)}
  }
  \newtcolorbox[auto counter, number within=section]{solution}[1][]
  {
    colframe = violet!25,
    colback  = violet!10,
    coltitle = violet!20!black,  
    breakable, 
    title = \textbf{Solution \thetcbcounter}
  }
  \newtcolorbox[auto counter, number within=section]{lemma}[1][]
  {
    colframe = red!25,
    colback  = red!10,
    coltitle = red!20!black,  
    breakable, 
    title = \textbf{Lemma \thetcbcounter ~(#1)}
  }
  \newtcolorbox[auto counter, number within=section]{theorem}[1][]
  {
    colframe = red!25,
    colback  = red!10,
    coltitle = red!20!black,  
    breakable, 
    title = \textbf{Theorem \thetcbcounter ~(#1)}
  } 
  \newtcolorbox[auto counter, number within=section]{proposition}[1][]
  {
    colframe = red!25,
    colback  = red!10,
    coltitle = red!20!black,  
    breakable, 
    title = \textbf{Proposition \thetcbcounter ~(#1)}
  } 
  \newtcolorbox[auto counter, number within=section]{corollary}[1][]
  {
    colframe = red!25,
    colback  = red!10,
    coltitle = red!20!black,  
    breakable, 
    title = \textbf{Corollary \thetcbcounter ~(#1)}
  } 
  \newtcolorbox[auto counter, number within=section]{proof}[1][]
  {
    colframe = orange!25,
    colback  = orange!10,
    coltitle = orange!20!black,  
    breakable, 
    title = \textbf{Proof. }
  } 
  \newtcolorbox[auto counter, number within=section]{definition}[1][]
  {
    colframe = yellow!25,
    colback  = yellow!10,
    coltitle = yellow!20!black,  
    breakable, 
    title = \textbf{Definition \thetcbcounter ~(#1)}
  } 
  \newtcolorbox[auto counter, number within=section]{example}[1][]
  {
    colframe = blue!25,
    colback  = blue!10,
    coltitle = blue!20!black,  
    breakable, 
    title = \textbf{Example \thetcbcounter ~(#1)}
  } 
  \newtcolorbox[auto counter, number within=section]{code}[1][]
  {
    colframe = green!25,
    colback  = green!10,
    coltitle = green!20!black,  
    breakable, 
    title = \textbf{Code \thetcbcounter ~(#1)}
  } 

  \BeforeBeginEnvironment{example}{\savenotes}
  \AfterEndEnvironment{example}{\spewnotes}
  \BeforeBeginEnvironment{lemma}{\savenotes}
  \AfterEndEnvironment{lemma}{\spewnotes}
  \BeforeBeginEnvironment{theorem}{\savenotes}
  \AfterEndEnvironment{theorem}{\spewnotes}
  \BeforeBeginEnvironment{corollary}{\savenotes}
  \AfterEndEnvironment{corollary}{\spewnotes}
  \BeforeBeginEnvironment{proposition}{\savenotes}
  \AfterEndEnvironment{proposition}{\spewnotes}
  \BeforeBeginEnvironment{definition}{\savenotes}
  \AfterEndEnvironment{definition}{\spewnotes}
  \BeforeBeginEnvironment{exercise}{\savenotes}
  \AfterEndEnvironment{exercise}{\spewnotes}
  \BeforeBeginEnvironment{proof}{\savenotes}
  \AfterEndEnvironment{proof}{\spewnotes}
  \BeforeBeginEnvironment{solution}{\savenotes}
  \AfterEndEnvironment{solution}{\spewnotes}
  \BeforeBeginEnvironment{question}{\savenotes}
  \AfterEndEnvironment{question}{\spewnotes}
  \BeforeBeginEnvironment{code}{\savenotes}
  \AfterEndEnvironment{code}{\spewnotes}

  \definecolor{dkgreen}{rgb}{0,0.6,0}
  \definecolor{gray}{rgb}{0.5,0.5,0.5}
  \definecolor{mauve}{rgb}{0.58,0,0.82}
  \definecolor{lightgray}{gray}{0.93}

  % default options for listings (for code)
  \lstset{
    autogobble,
    frame=ltbr,
    language=C,                           % the language of the code
    aboveskip=3mm,
    belowskip=3mm,
    showstringspaces=false,
    columns=fullflexible,
    keepspaces=true,
    basicstyle={\small\ttfamily},
    numbers=left,
    firstnumber=1,                        % start line number at 1
    numberstyle=\tiny\color{gray},
    keywordstyle=\color{blue},
    commentstyle=\color{dkgreen},
    stringstyle=\color{mauve},
    backgroundcolor=\color{lightgray}, 
    breaklines=true,                      % break lines
    breakatwhitespace=true,
    tabsize=3, 
    xleftmargin=2em, 
    framexleftmargin=1.5em, 
    stepnumber=1
  }

% Page style
  \pagestyle{fancy}
  \fancyhead[L]{Quantitative Finance}
  \fancyhead[C]{Muchang Bahng}
  \fancyhead[R]{Spring 2024} 
  \fancyfoot[C]{\thepage / \pageref{LastPage}}
  \renewcommand{\footrulewidth}{0.4pt}          % the footer line should be 0.4pt wide
  \renewcommand{\thispagestyle}[1]{}  % needed to include headers in title page

\begin{document}

\title{Quantitative Finance}
\author{Muchang Bahng}
\date{Spring 2024}

\maketitle
\tableofcontents
\pagebreak

\section{Primer on Economics}

    The most common principle in finance is that money has a time value. If you were to get \$1 today or \$1 in one year, you should always pick \$1 today since you can take that dollar and deposit it had a bank to receive interest for a year.\footnote{We will assume interest rates to always be nonnegative, though there are some nontrivial cases where it is negative.} To set up the proper terminology without assumption of knowledge, let's walk through a hypothetical scenario. 

    Say that party A wants to borrow $X$ dollars from party B. There are some factors to consider here. First, for what period of time will A borrow from B? This is easily agreed upon between the two. Second, what is the interest rate that B will charge A for borrowing? This is dependent on multiple factors, but it ultimately follows the basic principle that riskier loans require higher interest rates. 
    \begin{enumerate}
      \item If A has good \textbf{creditworthiness}, then B should charge lower interest rates since the risk of default\footnote{This means not being able to pay back a loan.} is low.\footnote{How one's creditworthiness is determined is a whole other subject, so we will assume that this is known and not delve into the how. }
      \item If the length of time $T$ that A borrows money is longer, then the risk of default may be longer, so interest rates should be higher. 
      \item What are interest rates for other types of loans? Depending on the context on say the interest rate similar loans, the parties should agree on some reasonable price.  
    \end{enumerate} 
    There's a couple questions here (beyond how credit is determined). First, how do we quantify how riskier a longer loan is? If you borrow for 2 years vs 1 year, what should the interest rate be? Second, how are other comparable interest rates determined? More generally, how does the third point even work? It looks like we need more background, both qualitative and quantitative to elaborate on all these things. 

  \subsection{Interest Rates} 

    The amount of money loaned $X$ is called the \textbf{principal}, and the interest rate $r$ is represented as a percentage of the principal that needs to be payed in addition \textit{per year}. Therefore, the total amount of money A must pay to B at the end of $t$ years is 
    \begin{equation}
      X (1 + r)^t
    \end{equation} 
    Simple enough, but this model assumes that the loan compounds annually. This may not hold for certain loans, so really if we assume that across the whole $T$ years it is compounded $m$ times, then the total now becomes 
    \begin{equation}
      X (1 + r/m)^{mt}
    \end{equation}

    Using the fact that 
    \begin{equation}
      \lim_{n \rightarrow \infty} \bigg( 1 + \frac{1}{n}\bigg)^n = e
    \end{equation}
    we can model this with a continuous interest rate. 
    \begin{equation}
      X e^{rt}
    \end{equation}
    It is important to comfortably switch between these two types. The market is always effectively discrete since daily compounding is the highest practical frequency in loans, but continuous compounding (exponential growth) is often mathematically more convenient. 

    Now note the goals of the two parties A and B. 
    \begin{enumerate}
      \item A wants to minimize interest rate payment, so if A finds another lender with lower interest rate (with all else equal), then A will go to the new lender. 
      \item B wants to maximize interest rate payment, so if B finds another borrower willing to tolerate a higher interest (with all else equal, like creditworthiness), then B will lend to the new borrower. 
    \end{enumerate}

    There is borrower that everyone has access to: the U.S. government (or could be some other entity). This entity is considered \textbf{risk-free}, meaning that they are guaranteed to give you back your money and so is the ideal place to lend to, with their own interest rate $r_f$ ($f$ for risk-\textbf{f}ree). Therefore, if you are a lender, you should always charge a rate higher than $r_f$, since if it was lower, you can get higher interest (\textit{and} better creditworthiness) by simply lending to the U.S. government. If you are a borrower, you should expect to pay more than $r_f$. Therefore we've essentially lower bounded all interest rates by $r_f$. 
    \begin{equation}
      r > r_f
    \end{equation}
    Again, this only holds true given that everything else is equal, such as the time of borrowing. One person might ask why the government doesn't lower its own interest rates even further? By doing this, the government can save money by having to pay less interest. This is true, but this assumes that the government is trying to make a profit, which is not true. The government controls the flow of money, and setting this risk free rate is strictly to do that. 

    \begin{example}[Home Loans]
      \textbf{Mortgages} are loans to individuals to buy a house, which last either 15 years and 30 years. Historically, the home loan rates are documented below\footnote{The shaded areas represent economic recessions.}, where we can see that the 30 year rates are consistently higher. In order to understand why rates are the way they are, we will need to read further. 
      \begin{figure}[H]
        \centering 
        \includegraphics[scale=0.25]{img/mortgage.png}
        \caption{15-Year and 30-Year Fixed Rate Mortgage Average in the United States [FRED]} 
        \label{fig:mortgage}
      \end{figure}
    \end{example}

    There are countless loans, such as auto loans, home loans, student loans, bonds, etc. So how are these interest rates actually determined? To answer this, we must delve a little into macroeconomics. We will first talk about how banks work, the monetary policy, and the federal funds rate which then determines all other interest rates. 

  \subsection{Banks and Monetary Supply}

    Most financial institutions such as banks make money from interest they earn by lending out money to other clients. It is clear that the interest rate paid by the bank on the money they borrow is less than the rate charged on the money they lend. Therefore, the majority of the deposits are not held by the bank. 

    \begin{figure}[H]
      \centering 
      \includegraphics[scale=0.3]{img/Banks_Profit_on_Interest.jpg}
      \caption{Banks charge higher interest on loans than they pay on deposits to make a profit.}  
      \label{fig:Banks_Profit_on_Interest}
    \end{figure}

    How one keeps this money is important. We start off with the most liquid vs the least liquid. 

    \begin{definition}[Physical Currency]
      The \textbf{physical currency} represents banknotes and coins. This is clearly extremely liquid since if you physically have it, you can use it whenever you want. 
      \begin{figure}[H]
        \centering 
        \includegraphics[scale=0.4]{img/currency_circulation.png}
        \caption{Currency in circulation} 
        \label{fig:circulation}
      \end{figure}
    \end{definition}

    \begin{definition}[Demand Deposits]
      \textbf{Demand deposits} refer to funds that can be withdrawn immediately at the holder's request without prior notice given to the bank. This is pretty much a checkings account. 
      \begin{figure}[H]
        \centering 
        \includegraphics[scale=0.4]{img/demand_deposit.png}
        \caption{Demand deposits. } 
        \label{fig:demand_deposit}
      \end{figure}
    \end{definition}

    \begin{definition}[Savings Deposits]
      A \textbf{savings deposit} is less liquid than a checkings account since there are usually restrictions on how often you can withdraw from it. However, where this resides is a bit fuzzy, since savings accounts are also very liquid.\footnote{For example, at Bank of America you can withdraw up to 3 times without prior notice. }

    \end{definition}

    Since demand and savings deposits can be converted into real money in the near future, they are referred to as \textit{near money}. 

    \begin{definition}[Time/Term Deposits]
      \textbf{Time/Term deposits}, on the other hand, require the customer to lock in their money at a bank. This is further categorized into how long the term is (7 days to 2 years are considered \textit{short-term} and beyond are \textit{long-term}) and how big the deposit is (\$100k or more are considered large deposits). 
      \begin{figure}[H]
        \centering 
        \includegraphics[scale=0.4]{img/time_deposits.png}
        \caption{Time deposits} 
        \label{fig:time_deposit}
      \end{figure}
    \end{definition}

    Term deposits are referred to as \textit{near, near money}. 

    \begin{definition}[Levels of Monetary Supply]
      In the U.S. (or any other nation), there is a certain amount of money flowing through the economy, known as the \textbf{monetary supply}. There are many subcategories of this, which we will elaborate now. 
      \begin{enumerate}
        \item \textbf{M0} is the total of all physical currency in public circulation and held by the public along with bank reserves\footnote{These are accounts at the central bank that can be exchanged for physical currency, which will be elaborated later}. 
        \item \textbf{M1} is M0 plus demand deposits and savings deposits. This is the most widely used metric of money supply. 
        \item \textbf{M2} is M1 plus short-term time deposits. 
        \item \textbf{M3} is M2 + large time deposits and \textit{money market funds}, which are funds that invest in short-term securities.\footnote{This is discontinued since 2006 by the fed since it provided no useful indicators. }
      \end{enumerate}
      You can see the monetary supply in the U.S., which are updated weekly. The M3 is updated quarterly. Since it consists of other assets that are less volatile, it is generally less volatile than M1. Note that prior to May 2020, savings accounts were not included in M1, but due to increased liquidity it is now included.
      \begin{figure}[H]
        \centering 
        \includegraphics[scale=0.4]{img/Ms.png}
        \caption{M1 and M2 monetary supply. } 
        \label{fig:Ms}
      \end{figure}
    \end{definition}

  \subsection{Federal Funds Rate} 

    This can be risky since if a lot of people want to withdraw their money from the bank at once, the banks may not have enough liquidity to pay them back, leading to panic. In order to minimize the possibility of these bank runs, the Fed legally requires banks to have a required \textbf{reserve ratio} (the amount of funds that a bank holds in reserve to ensure that it is able to meet liabilities in case of sudden withdrawals), which have historicaly been between 0\% and 10\% of total deposits. These \textbf{federal funds} (the minimum amount required to have) are stored in the regional Federal Reserve banks (so the central bank acts as the banks' bank). The end-of-the-day balances in each bank's account, averaged over two-week reserve maintenance periods, are used to determine whether the bank meets its reserve requirements. 

    \begin{figure}[H]
      \centering 
      \includegraphics[scale=0.3]{img/Fed_Funds_Rate.jpg}
      \caption{If the reserve ratio is 10\%, commercial bank A must deposit \$100M in the Fed and can lend out \$900M. Bank B must deposit \$200M in the Fed and can lend out \$800M. } 
      \label{fig:Fed_Funds_Rate}
    \end{figure}

    \begin{definition}[IOER and Discount Rate]
      There is a dynamic relationship between the federal bank and the many commercial banks. They can lend money to each other, and depending on who lends who, different rates are charged. The two rates below are directly controlled by the Fed.
      \begin{enumerate}
        \item The \textbf{interest rate on reserve balances (IORB)} is a combination of the \textbf{interest rate on required balances (IORR)} and \textbf{interest rate on excess reserves (IOER)}, which are the rates of interest that the central bank pays commercial banks on required reserves and excess reserves. These are directly controlled by the Fed.
        \item The \textbf{discount rate} is the rate of interest that commercial banks pay the central bank. Directly controlled by the Fed.
      \end{enumerate}
    \end{definition}

    Recognize that each bank wants to hold the optimal amount of federal funds. If it holds too few federal funds, it might not be able to honor its obligations to other banks (e.g., when they show up with checks written by its customers) or might fall below the legal amount of reserves it is required to hold. If it holds too many federal funds, it will earn less interest on its assets than it otherwise would on other investments. Hence, each bank is trying to hold the optimal amount of reserves, given its unique position and the opportunity cost of holding reserves. So, there will inevitably be banks that hold too many federal funds that can lend money to banks that hold too few federal funds. Therefore, this money can be lent between banks, with the promise that those funds are paid back overnight.

    \begin{definition}[Federal Funds Rate]
      This financial market in which interbank lending occurs in the U.S. is called the federal funds market, and the interest rate the lending bank can charge is referred to as the federal funds rate (FFR). There are two variations of this rate:
      \begin{enumerate}
        \item The actual interest rate for a loan between two banks is determined through negotiations between them. The weighted average of this rate across all such transactions on a certain night is the federal funds effective rate (FFER).
        \item The federal funds target rate (FFTR) is a (usually quarter percent) range set by the FOMC (usually 8 times a year) as a guidepost, which they enforce by open market operations and adjustments in IOR/IOERs. The target rate is almost what is meant by the media referring to the Fed "changing interest rates." The actual FFR generally lies within the range of that target rate.
      \end{enumerate}
    \end{definition}

    Note that the FFR is the benchmark interest rate of the economy, since all other interest rates on loans from commercial banks are dependent on it. That is, a higher FFR will mean that commercial banks will have to raise interest rates on all of their loans (to profit accordingly), and a lower FFR will mean that banks will lower their interest rates on loans. Therefore consumers should care about the FFR since it influences how much they pay to borrow and how much they're paid to save. 

    \begin{figure}[H]
      \centering 
      \includegraphics[scale=0.3]{img/3_Interest_Rates.jpg}
      \caption{A visual diagram of the three interest rates: IOER, Discount, and FFR. } 
      \label{fig:3_Interest_Rates}
    \end{figure}

    \begin{theorem}[FFR]
      There are simple relationships between these rates. If I am a commercial bank that needs money to satisfy my overnight reserve requirements, then I can either borrow from the Fed (with the discount rate) or other commercial banks (with FFR). 
      \begin{enumerate}
        \item Since borrowing from the Fed with the fixed discount rate is always an option, other commercial banks should naturally have an FFR lower than the discount (EFFR<Discount).
        \item If I am a commercial bank that has extra money, then I can either loan it to the Fed at the IOER rate or other commercial banks at the FFR. The FFR should naturally be higher than the IOER (IOER<EFFR). 
      \end{enumerate}
      Combining these two gets 
      \begin{equation}
        \text{IOER} < \text{EFFR} < \text{Discount}
      \end{equation}
      Since the Fed has direct control over IOER and Discount, it has control over the FFR, which lies in between the two. 
    \end{theorem}

    \begin{question}
      IOER has been actually greater than FFR consistently in the past 10 years. Why? Read \href{https://www.clevelandfed.org/publications/economic-commentary/2017/ec-201707-the-federal-funds-market-since-the-financial-crisis}{this}. 
    \end{question}

    Since the FFR is really the interest rate at the bottom of the chain, all other interest rates are essentially functions of the FFR.   

  \subsection{Monetary Policy}

    Now, we describe how the Fed uses these policies to control the monetary supply. We can interpret some sum of money "being" or "flowing" in the economy if it is available to use by commercial banks to invest in other securities, i.e., not in the federal funds. Also note that increasing the money in the economy allows commercial banks to have more cash reserves on hand, which induces them to lend them out at lower rates, making loans easier to get in the overnight market and thus decreasing the FFR. Keep in mind that
    \begin{align*} 
      \text{More money in economy} & \iff \text{FFR decreases}, \\
      \text{Less money in economy} & \iff \text{FFR increases}.
    \end{align*}

    \begin{definition}[Open Market Operations]
      The Fed can finally conduct \textbf{open market operations (OMO)}, which means to buy and sell government securities in the open market.
      \begin{enumerate}
        \item Buying government bonds (with possibly newly printed money) from a group of banks (or other entities in the market) $\rightarrow$ banks get more money by selling the bonds $\rightarrow$ more money supply in commercial banks \& economy $\leftrightarrow$ FFR decreases,
        \item Selling government bonds to banks (or other entities in the market) $\rightarrow$ banks lose money by buying the bonds $\rightarrow$ less money supply in commercial banks \& economy $\leftrightarrow$ FFR increases.
      \end{enumerate}
    \end{definition}

    \begin{definition}[Modifying Reserve Requirements]
      The simplest thing the Fed can do is change the reserve requirements that banks must keep in the central bank.
      \begin{enumerate}
        \item Lowering reserve requirements $\rightarrow$ Lower percentage of bank deposits must be in federal reserve $\rightarrow$  More money supply in commercial banks \& economy $\leftrightarrow$ FFR decreases,
        \item Raising reserve requirements $\rightarrow$ Greater percentage of bank deposits must be in federal reserve $\rightarrow$  Less money supply in commercial banks \& economy $\leftrightarrow$ FFR increases.
      \end{enumerate}
    \end{definition}

    \begin{definition}[Changing Discount Rate]
      The Fed can also change the discount rate that banks pay on short-term loans from the Federal Reserve bank.
      \begin{enumerate}
        \item Lowering discount rate $\rightarrow$ Easier for commercial banks to borrow from Fed $\rightarrow$ more money supply in commercial banks \& economy $\leftrightarrow$ FFR decreases,
        \item Raising discount rate $\rightarrow$ Harder for commercial banks to borrow from Fed $\rightarrow$ less money supply in commercial banks \& economy $\leftrightarrow$ FFR increases.
      \end{enumerate}
    \end{definition}

    \begin{definition}[Changing IOR/IOER Rates]
      It can change the IOR/IOER. It's really just the IOER since the IOR rate applies only to mandatory reserves, while the IOER is on excess reserves.
      \begin{enumerate}
        \item Lowering IOER rate $\rightarrow$ Banks prefer to lend funds out rather than keep it in Fed $\rightarrow$ more money supply in commercial banks \& economy $\leftrightarrow$ FFR decreases,
        \item Raising IOER rate $\rightarrow$ Banks prefer to keep funds in Fed than lend to potentially risky borrower $\rightarrow$ less money supply in commercial banks \& economy $\leftrightarrow$ FFR increases.
      \end{enumerate}
    \end{definition}

    \subsubsection{Money Multiplier Effect}

      Recall that the $M0$ monetary supply, or the monetary base, is the total amount of money that the Fed has injected into the U.S. economy. For this reason, the monetary base is also called \textbf{high-powered money}. However, the $M1$ and $M2$ supplies are usually much larger than the $M0$. As of 2021, the $M0$ supply is USD 6.4T, while the $M1$ is USD 20.6T and $M2$ is 21.6T. Where did this extra money come from? The \textbf{multiplier effect}, which exists in the \textbf{fractional reserve banking system}, tells us that infusions of capital will have a broad snowball effect on various aspects of economic activity. That is, if the government injects a certain amount of money into the economy, it turns out that the money supply increases by multiple factors of what was put in.

      Suppose that the government prints USD 10B and credits an additional USD 90B (i.e., credits loans by selling bonds) to banks and other depository institutions. At first, it might seem like the economy just received a monetary influx of USD 100B, but that is actually a very small percentage of the actual money creation. Let us assume that the reserve requirement is 10\% (that is, all depository institutions must have 10\% of their deposits kept in the federal reserve).

      \begin{enumerate}
        \item The banks get USD 100B. With the 10\% requirement, they must keep 10B in reserves and can lend out 90B in investments or loans, which goes into the hand of institutions and individuals. There is a total of 100B in money supply: 90B lent out and 10B in reserves.
        \item These institutions/individuals will deposit the 90B receivings in banks. The banks get USD 90B. With the 10\% requirement, they must keep 9B in reserves and can lend out 81B in investments or loans, which goes into the hand of institutions and individuals. There is a total of 190B in money supply: 90+81=171B lent out and 10+9=19B in reserves.
        \item These institutions/individuals will deposit the 81B receivings in banks. The banks get USD 81B. With the 10\% requirement, they must keep 8.1B in reserves and can lend out 72.9B in investments or loans, which goes into the hand of institutions and individuals. There is a total of 271B in money supply: 90+81+72.9=243.9B lent out and 10+9+8.1=27.1B in reserves.
        \item These institutions/individuals will deposit the 72.9B receivings in banks. The banks get 72.9B USD...
      \end{enumerate}

      Calculations for the first few deposit/lending cycle is shown. Note that money supply is all of the amount lent out until now plus all the reserves accumulated until now.

      \begin{tabular}{|l|l|l|l|l|l|}
      \hline
      Bank & Deposit Amount & Amount Lent Out & Money Supply & Reserves & Total Reserves \\
      \hline
      1 & \$100.00 & \$90.00 & \$100.00 & \$10.00 & \$10.00 \\
      2 & \$90.00 & \$81.00 & \$190.00 & \$9.00 & \$19.00 \\
      3 & \$81.00 & \$72.90 & \$271.00 & \$8.10 & \$27.10 \\
      4 & \$72.90 & \$65.61 & \$343.90 & \$7.29 & \$34.39 \\
      5 & \$65.61 & \$59.05 & \$409.51 & \$6.56 & \$40.95 \\
      6 & \$59.05 & \$53.14 & \$468.56 & \$5.90 & \$46.86 \\
      7 & \$53.14 & \$47.83 & \$521.70 & \$5.31 & \$52.17 \\
      \ldots & \ldots & \ldots & \ldots & \ldots & \ldots \\
      \hline
      \end{tabular}

      This continues on in the form of a geometric series with a common ratio of 0.9 (1 minus the reserve ratio of 10\%). After an infinite time, the total money supply converges 10 times USD 100B to become USD 1 trillion.

      One subtle distinction that we must mention is that in the ideal case where banks loan out precisely 90\% of their deposits and the economy deposits 100\% of their savings, this multiplier is actually called the \textbf{deposit multiplier}. It is indeed the case that the reserve requirement is about 10\%, but the $M1/M2$ supplies are not even close to 10 times the $M0$ supply. This is because of imperfections due to excess reserves, savings, and conversions to cash by consumers, the actual multiplier, called the \textbf{money multiplier}, is ultimately less. Borrowers do not spend all of the money received from bank loans. If they did, and if banks loaned out every possible dollar beyond the minimum reserve requirements, then the deposit multiplier and the money multiplier would be close to exactly equivalent.

\section{Markets}

  If we have two parties that want to exchange goods, they can meet up, decide on a price, and exchange the good. However, when it comes to many players, we must make some sort of exchange. We go over the construction of one. 

  \subsection{Counterparties and Clearing Houses}

    Think about when one party buys stocks or bonds. Their downside is limited to the amount they paid on the stock, but there are many other cases where they may not be protected. 

    \begin{definition}[Default]
      If a borrower fails to pay back a debt or cover a loss, then they \textbf{default}. 
    \end{definition}

    \begin{example}[Risks Associated with Trades]
      \begin{enumerate}
        \item The simplest case is when they are in debt. They want to borrow $X$ for a certain time, and repay it back in a year at some interest rate $X (1 + r)$. However, they may not have the money by then. 
        \item When they short a stock, they can borrow money from another party that owns the stock, sell it, and buy it back at a lower price. However, if the price of the stock rises, then they must pay even more money to buy it back, and they may not have enough money to. 
        \item When they buy a stock on margin, they borrow money from a broker to buy the stock, and they must pay back the broker with interest. However, the price of the stock may fall and the borrower, even after liquidating the stock, may not have enough money to pay back the broker.
        \item Someone who longs a forward contract may not have enough money to pay the difference between the forward price and the spot price.
      \end{enumerate}
    \end{example}

    \begin{definition}[Counterparty]
      A \textbf{counterparty} is the other party in a financial transaction. 
    \end{definition}

    Note that in a vanilla exchange, the two parties trading are counterparties to each other. This is called a \textbf{bilaterial exchange}. As we have seen, this is risky since if one party defaults, the other party is left with nothing. Therefore, the markets introduce a middleman that takes care of this risk. 

    \begin{definition}[Clearing House]
      The \textbf{clearing house} is an entity that is counterparty to all parties. This means that if party A and party B want to trade, they must go through the clearing house. The clearing house buys from B and sells to A. Therefore, the counterparty risk is now within the clearing house.
    \end{definition}

    It seems that we have simply moved the risk from the traders to the clearinghouse, and this is correct. The traders are glad that the risk is gone from them since they will always be paid by the clearinghouse, and the clearinghouse can add additional regulations on trading to reduce the risk of default. The first regulation they should impose are margin requirements. 

    \begin{definition}[Margin]
      \textbf{Margin} is simply cash or some other asset (stocks, bonds, etc.) that can be used as collateral during a trade. Note that this does not mean that the collateral must be invested into anything. It is just restricted to sit there in your bank account. 
      \begin{enumerate}
        \item Cash is the most liquid form of margin, and is the most common form of margin. 
        \item Bonds are also a common form of margin, and Treasury bonds are usually valued at 90\% of their market value.
        \item Stocks are also a common form of margin, and are usually valued at 50\% of their market value. 
      \end{enumerate}
    \end{definition}

    The margin requirements are generally very inflexible unless you have a good relationship with your broker and are a big trader. Now that we've seen the important roles that a clearing house plays, we look at the development of more complex markets, namely, the exchange and OTC markets. 

  \subsection{Exchange Markets}

    In a trading floor or pit, there are groups of traders huddled at certain physical locations that trade a certain asset, like corn futures. Back then, there would be individual traders that have their own small capital that they can trade with, called \textbf{locals}, but they have been dominated by traders that work for large financial institutions, causing locals to be either pushed our or joined with the firms. Market making firms like Akuna have pit traders, who have headsets and tablets, that are in real-time communication with the screen traders upstairs. 

    Standing in the perimeter of the trader circle are the \textbf{brokers}, who relay orders between the traders in the pit and outside of the pit. These brokers also have devices that allow them to communicate with \textbf{off floor} parties, who are individuals that are interested in these products. 

    \begin{example}[Off Floor Parties]
      Some examples of off floor parties are: 
      \begin{enumerate}
        \item Hedge funds, who have devised trading strategies that they want to implement, e.g. using drones to look at the harvest quantity. Now they want to gain exposure to the corn market. 
        \item Banks might also want to use client money to develop a trading strategy. 
        \item Consumers such as Kellogs (which needs a lot of corn to make cereal) might be interested in buying contracts to hedge their underlying exposure. 
        \item Producers like corn farmers might want to buy some contract to lock in the price in which they can sell it at. 
        \item Large funds like pension funds or family money. 
        \item Retail investors like small, non-professional traders that might dabble in options.  
        \item Other market makers might be connected to these brokers
      \end{enumerate}
    \end{example}

    There is specific terminology that we should introduce first. 

    \begin{definition}[Bid, Offer]
      
    \end{definition}
    Now if some off floor party decides to sell some calls, they will call their broker and ask to quote some prices. This means that they are asking for bid and offer prices. These traders might quote the following prices: 



    When more people want to buy and sell things, they must go to an \textbf{exchange}, which is literally a physical space that is leased to various parties (e.g. large banks, hedge funds) so that they can exchange goods. These exchanges also collect money through fees from companies to be listed on NYSE. There are two big exchanges, the NYSE and the NASDAQ, in the U.S., both located in New York. 

    Us retail traders are not direct participants of the exchange; the parties that participate there are called the \textbf{market makers}, or \textbf{liquidity providers}. Market makers, usually large banks or financial institutions (like hedge funds), make sure that there is enough trading volume to ensure liquidity in the market. A buyer and a seller must meet together to complete a deal, and to ensure that this happens smoothly (i.e. provides liquidity), a market maker buys stocks (through the individual's brokerage) and sells them to the corresponding recipient. Essentially, they provide a pool of shares and act as intermediaries between them. They profit from the bid-ask spread, though sudden volatility is always a risk. For example, if a crash happens (i.e. a market maker buys a stock and it tanks before they can sell it), then the market makers get screwed because they are left with an undervalued stock. 

    The trader cannot directly trade through the market makers. They must contact their \textbf{broker}, which is another company that acts as an intermediary. If I want to buy a stock, my buy order gets sent to my broker, which gets sent to the market makers, which pairs me up with a seller through their own broker, and the transaction is completed. These brokers make money through commissions from the traders and from trading in dark pools, which we'll talk about later. They also give access to traders the forecasts of analyst reports for companies and other research. 

    \begin{center}
        \includegraphics[scale=0.3]{img/exchange.jpg}
    \end{center}

    Clearly, there can be some shady stuff going on here, but luckily, the SEC and the FINRA consistently regulate the markets to ensure fairness for the little players (retail investors). One of the most important regulations is the 2005 Regulation NMS (National Market System), which required exchanges to publish the best bid and offer price for each stock, required them to route orders to the trading venue with the best price, and had set the minimal price quotation increment to \$0.01. This ensured transparency and protection of the investor with the best price execution (but this can be taken advantage of by high frequency traders). 

    \begin{definition}[Exchange Markets]
      \textbf{Exchange markets} are markets that exchange \textit{standardized} contracts and is \textit{highly regulated} (to protect investors) by a central authority. A buyer and seller come together to trade a contract, and they enter the contract through a \textbf{clearing house}, which is the \textit{counterparty} to all trades. That is, both the buyer and seller enter into a contract with the clearing house. Doing this reduces the counterparty risk by ensuring that both sides have adequate \textit{margin}. For example, if the buyer wins the bet and the seller can't pay, the clearing house will pay the buyer.
    \end{definition}

    \begin{question}
      Talk about counterparties, clearinghouses. 
    \end{question}

    \subsubsection{Market Making and High Frequency Trading}

      A significant mover of markets are \textbf{high frequency traders}, or HFTs. HFT is a type of algorithmic trading that are characterized by high speeds and high turnover rates. It is the primary type of algorithmic trading and consists of about 50\% of all equity trades in the U.S. There is an average of about 1 trader per 10 milliseconds. Whether HFT is beneficial is very controversial: 
      \begin{enumerate}
          \item Some argue that it is good since it increases liquidity and lowers transaction costs for retail investors. Even for potentially risky stocks (e.g. very overvalued), HFTs will always make a market out of them. 
          \item It can be considered unfair because it gives a huge advantage to HFT firms through front-running and other short-term strategies. This also increases the probability of \textbf{flash-crashes} (e.g. 2010 flash crash). 
      \end{enumerate}
      Unsurprisingly, many HFT firms are market makers due to their ability to provide liquidity. 

      The primary form of HFT is \textbf{scalping}, which profits off of small price changes. The multiple benefits and drawbacks are easy to spot: 
      \begin{enumerate}
          \item It requires a strict exit strategy since one large loss could eliminate the many small gains the trader worked to obtain. 
          \item It also requires a much higher ratio of winning trades vs losing ones, while keeping profits roughly equal or slightly bigger than losses. 
          \item A brief exposure to the market diminishes the probability of running into an adverse event like a crash. 
          \item Smaller moves are easier to obtain, so there are plenty of opportunities to exploit. 
      \end{enumerate}
      This strategy is extremely sensitive that even the physical location of the firm relative to the exchange matters. Heavy money in infrastructure is invested. 

  \subsection{Over the Counter Markets}

    \begin{definition}[OTC Markets]
      In \textbf{over the counter markets} (OTC), there is also an interaction between the buyer and the seller, but it is done in two ways. 
      \begin{enumerate}
        \item In \textit{bilateral clearing}, the buyer and seller are the counterparties to each other, and so there is indeed the risk of default on one side. 
        \item Post-2008, there has been a push to clear through a \textit{central counterparty}. Therefore, there has been a slow push to clear OTC derivative trading to reduce this counterparty risk. 
      \end{enumerate}
      Finally, the OTC market is much larger (about 5 to 10 times larger in terms of the principal dollars underlying the assets) than the exchange and is less regulated since most of the players are institutional investors (they don't need as much protection but need more flexibility).  
    \end{definition}

  \subsection{Dark Pools}

    The inefficient aspect about markets that they are sensitive to large \textbf{block trades}, which are defined to be a trader involving at least 10,000 shares or at least \$200,000 (though they can get much larger). They are usually made by institutional investors and are often privately negotiated in order to prevent market price changes and fluctuations. When an institutional investor would like to make a sell block trade, they can either 
    \begin{enumerate}
        \item sell it on the exchange, where it will cause downwards pressure on the price, causing \textbf{slippage} (think of the limit order book: this sell order would clear out all buy orders past the sell price) and perhaps affecting the wider market. Even worse, once an order to sell a huge block has been filled, an investor can submit a buy order at a lower price in hopes that the block sell will hit his lowered price (this is an example of front running). 
        \item sell it privately off an exchange, but finding other parties to buy such a large amount is difficult. 
    \end{enumerate}
    Either way is quite unfavorable. The market impact of a sale of one million shares in Company XYZ could still be sizable regardless of which option the investor chose since it was not possible to keep the identity or intention of the investor secret in a stock exchange transaction. 

    These investors can trade in \textbf{dark pools}, which are privately organized financial exchanges for trading securities, also an \textbf{alternative trading system} (ATS). They were created originally to facilitate block trading by institutional investors who did not wish to impact the markets with their large orders. Most importantly, they keep trades anonymous. They allow traders to make block trades without having to publicize who they are, the buy/sell price, or the number of shares traded. 

  \subsection{Market Manipulation}

    \textbf{Market manipulation} is a type of market abuse where there is a deliberate attempt to interfere with the free and fair operation of the market. 
    \begin{enumerate}
      \item \textbf{Stock Bashing}: Creating fake news about a company to drive prices down and get shares for a cheaper price. The perpetrators sometimes work directly for Investor Relations firms who have convertible notes that convert cor more shares the lower the bid or ask price is. Thus, the bashers can drive the stock price down by convincing shareholders that they have bought a worthless security. 
      \item \textbf{Pump and Dump}: Misleadingly promoting a company to drive share prices up (the "pump", e.g. with bogus emails to investors). When the stock price reaches a target level, the promoter sells their shares (the "dump"). 
      
      \item \textbf{Spoofing / Layering}: When a trader places a bid or offer on a stock with the intent to cancel before execution, these fake order trick other market participants by creating the false impression of heavy buying or selling pressure. Layering is an advanced form of spoofing with multiple orders that are "layered." For example, let's say that I want to buy stock XYZ, which is priced at \$100. If I wanted to use layering, I would put a sell order of 100 stocks at \$101, 100 at \$102, and 100 at \$103. An algorithm or trader might see this and believe that there is selling pressure and jump in front of these orders before they go down. They might sell at the market price of \$100, which may bring the price of XYZ a bit lower, to say \$99.95. I can buy at this price now. 
      
      \item \textbf{Front Running / Tailgating}: This is the practice of entering into a transaction that takes advantage of nonpublic knowledge of a large "block" pending transaction that will influence the price of an underlying security. Say a broker gets an order from a major client to buy 500,000 shares of XYZ Co. Such a huge purchase is bound to drive up the price of the stock immediately, at least in the short term. The broker sets aside the request for a minute and first buys some XYZ stock for their own personal portfolio or through accounts of relatives. Then the client's order is put through. The broker immediately sells the XYZ shares and pockets a profit. This can be used by HFT firms, since with the knowledge of large block buy orders from institutions, they can "buy up" all the orders in the market and sell it at a slightly higher price to the institutions. 
      
      \item \textbf{Quote Stuffing}: This is the practice of quickly entering and withdrawing a large number of orders in an attempt to flood the market, used by HFT firms. This can create confusion in the market (by filling up bandwidth and increasing latency of the data feed lines) and trading opportunities for high-speed algorithmic traders. 
    \end{enumerate}

    Another illegal act, which isn't market manipulation, is \textit{insider trading}, which refers to a company insider who trades on advanced knowledge of corporate activities. 

\section{Bond Markets}

    Introduce to IOUs and why people need to borrow. 

    \begin{definition}[Bond]
      A \textbf{bond} is a financial instrument that represents a loan made by an investor to a borrower (typically corporate or governmental). The borrower agrees to pay interest on the loan and to repay the principal at a later date. 
      \begin{enumerate}
        \item The \textbf{face value} of a bond is the amount that the bond issuer agrees to repay the bondholder at the maturity date. 
        \item The \textbf{coupon rate} is the interest rate that the issuer will pay on the face value of the bond. 
        \item The \textbf{maturity date} is the date on which the issuer will repay the bondholder the face value of the bond. 
        \item The \textbf{yield} is the rate of return earned on a bond. 
      \end{enumerate}
    \end{definition}

  \subsection{Primary Market and Types of Bonds} 

    \begin{definition}[Treasury Bonds]
      \textbf{Treasury bonds} are issued by the U.S. government and are considered to be the safest bonds available. 
      \begin{enumerate}
        \item The \textbf{Treasury bill} is a short-term debt obligation backed by the U.S. government with a maturity of less than one year. 
        \item The \textbf{Treasury note} is a marketable U.S. government debt security with a fixed interest rate and a maturity between one and 10 years.
        \item The \textbf{10-year Treasury bond} is a bond issued by the U.S. Treasury that matures in 10 years. 
        \item The \textbf{30-year Treasury bond} is a bond issued by the U.S. Treasury that matures in 30 years. 
        \item The \textbf{Treasury Inflation-Protected Securities (TIPS)} is a bond issued by the U.S. Treasury that is indexed to inflation to protect investors from the negative effects of inflation. 
      \end{enumerate}
    \end{definition}

    Treasury bills, notes, and bonds are issued through an electronic bill Dutch auction.\footnote{The website for upcoming auctions can be found \href{https://www.treasurydirect.gov/auctions/upcoming/}{here}.} A \textbf{Dutch auction} is an auction in which the price of something offered is determined after taking in all bids to arrive at the highest price at which the total offering can be sold. The bond auction is open to the public, both institutional and individual investors. 24 \textbf{primary dealers} (financial institutions and brokerages) are required to participate. It is divided into competitive and noncompetitive bids.
    \begin{itemize}
        \item \textbf{Competitive bids} are bids where the buyer specifies the rate that they will accept. It is mainly submitted by institutional investors, and competitive bidding is limited to 35\% of the offering amount for each bidder.
        \item \textbf{Noncompetitive bidding} are bids where the buyer agrees to accept the rate determined at the auction (same rate as that determined by competitive bids). It is submitted often by individuals, and noncompetitive bidding is limited to \$5 million per auction.
    \end{itemize}

    \begin{example}[Dutch Auction for Treasury Bonds]
      It is best to explain through an example: Suppose the Treasury seeks to raise \$9 million in two-year notes with a 5\% coupon. Entities can bid up to 30 days in advance of the auction, and let us assume that the submitted bids are as follows:
      \begin{itemize}
          \item \$1 million at 4.79\%
          \item \$2.5 million at 4.85\%
          \item \$2 million at 4.96\%
          \item \$1.5 million at 5\%
          \item \$3 million at 5.07\%
          \item \$1 million at 5.1\%
          \item \$5 million at 5.5\%
      \end{itemize}
      The bids with the lowest yield will be accepted first since the issuer will prefer to pay lower yields to its bond investors. In this case, since the Treasury is looking to raise \$9 million, it will accept the bids with the lowest yield up to 5.07\%. At this mark, only \$2 million of the \$3 million bid will be approved. All bids above the 5.07\% yield will be rejected, and bids below will be accepted. This auction is cleared at 5.07\%, and all successful bidders receive the 5.07\% yield.
    \end{example}

    \begin{definition}[Zero Coupon Bonds]
      \textbf{Zero-coupon bonds} do not pay coupon payments and are instead issued at a discount to their par value that will generate a return once the bondholder is paid the full face value when the bond matures (e.g., U.S. Treasury bills).
    \end{definition}

    \begin{definition}[Zero Coupon Bond]
      A \textbf{zero coupon bond (ZCB)} with maturity $T$ is an asset that pays $1$ at time $T$ (and nothing else). 
    \end{definition}

    Let $V(t, T)$ be value at current time $t$ of a ZCB with maturity $T$, for $t \leq T$. Then, it must be the case that $V(T, T) = 1$. Accounting for interest rates and the discounted value of money, we get the following result. 


    \begin{definition}[Types of Bonds by Issuer]
      Bonds can be categorized by the entities that issue them.
      \begin{enumerate}
        \item \textbf{Corporate bonds} are issued by companies. Companies issue bonds rather than seek bank loans for debt financing in many cases because bond markets offer more favorable terms and lower interest rates.
        \item \textbf{Municipal bonds} are issued by states and municipalities (local governments).
        \item \textbf{Government bonds}, or \textbf{treasury bonds}, are issued by the U.S. Treasury.
        \item \textbf{Agency bonds} are those issued by government-affiliated organizations (e.g., Fannie Mae).
      \end{enumerate}
    \end{definition}

    \begin{definition}[Types of Bonds by Grade]
      Bonds can also be categorized by their credit ratings. 
      \begin{enumerate}
        \item \textbf{Investment-grade bonds} are those rated BBB or higher by Standard \& Poor's or Baa3 or higher by Moody's. 
        \item \textbf{High-yield bonds} are those rated below investment grade (BB+ or lower by Standard \& Poor's or Ba1 or lower by Moody's). 
        \item \textbf{Junk bonds} are those rated below investment grade. 
      \end{enumerate}
    \end{definition}

    \begin{definition}[Other Categories of Bonds]
      Bonds can have other characteristics that distinguish them from each other. 
      \begin{enumerate}
        \item \textbf{Convertible bonds} are bonds that gives the bondholder the option to convert their debt into stock at some point, depending on conditions.
        \item \textbf{Reverse convertible bonds} are bonds that now give the \textit{issuer} the option to convert.
        \item \textbf{Callable bonds} is one that can be called back by the company before it matures, for instance, when interest rates become too disadvantageous for the issuers.
        \item \textbf{Puttable bonds} allow the bondholders to put (or sell) the bond back to the company before maturity.
      \end{enumerate}
    \end{definition}

    \subsubsection{Daycount Conventions}

      Another important concept to mention is the daycount conventions in the financial markets. Note that since a year consists of 365 days, when doing discrete compounding we cannot easily calculate $r/m$. For example, if we wanted to do quarterly payments, we would have $m = 4$ but we cannot split 365 into 4 parts. Note the following days in each quarter. 

      \begin{table}[H]
        \centering
        \caption{Number of days between quarterly dates}
        \label{table:quarterly_days}
        \begin{tabular}{@{}lc@{}}
        \toprule
        Period                               & Days \\ \midrule
        16 March 2011 to 16 June 2011        & 92   \\
        16 June 2011 to 16 September 2011    & 92   \\
        16 September 2011 to 16 December 2011& 91   \\
        16 December 2011 to 16 March 2012    & 91   \\ \bottomrule
        \end{tabular}
      \end{table}
      
      There are lots of imperfections and therefore there are many different market conventions. We list some of them. 

      \begin{definition}[Act/365]
        The \textbf{actual 365} (act 365) daycount convention calculates the quarterly interest rate by dividing by the number of days by 365. 
      \end{definition}

      \begin{definition}[Act/360]
        The \textbf{actual 360} (act/360) daycount convention calculates the quaterly interest by dividing the number of days by 360. 
      \end{definition}

      \begin{definition}[Act/Act]
        The \textbf{actual actual} (act/act) convention calculates the quaterly interest by dividing by the actual number of days in each year. This accounts for leap years. 
      \end{definition}    

      \begin{definition}[30/360]
        The \textbf{30 360} (30/360) convention assumes that there are 30 days in each month and was designed to produce equal amounts of interest payment each month or quarter. It calculates the quarterly interest by simply $120/360 = 1/4$.
      \end{definition}

      \begin{example}[Accural Factors for Each Quarter]
        The \textbf{accural factor} is the convention to divide a year into equal time periods, denoted by $\alpha$. For each quarter above, we can get 
      \end{example}

  \subsection{Valuation}

    \begin{theorem}[Value of Zero Coupon Bond]
      The value of a zero coupon bond at time $t$ with maturity $T$ with continuously compounded interest rate is 
      \begin{equation}
        V(t, T) = e^{-r(T-t)}
      \end{equation}
      and with discretely compounded interest rate is 
      \begin{equation}
        V(t, T) = \frac{1}{(1 + r_A)^{T - t}}
      \end{equation}
      where $r_A$ is the annually compounded rate. 
    \end{theorem}
    \begin{proof}
      We prove this result by \textit{discounting cashflows back to today}, which means to take whatever cashflow in the future, and discounting it at the interest rate to current time. If you had $e^{-r (T - t)}$ at time $t$, then you can invest it at the interest rate $r$, compounded continuously, to get 
      \begin{equation}
        e^{- r(T - t)} \cdot e^{r (T - t)} = 1
      \end{equation}
      after time $T - t$, which is what the ZCB pays. 
    \end{proof}

    If we assume that the price $P$ is a good approximate of the value $V$, then we can substitute it into the equation to get an estimate of the interest rate.  
    \begin{equation}
      P(t, T) (1 + r_A)^{(T - t)} = 1 \text{ or } P(t, T) e^{r (T - t)} = 1
    \end{equation}
    Note that $r$ is not constant across time, so it should really be written as 
    \begin{equation}
      P(t, T) (1 + r_A(t, T))^{(T - t)} = 1 \text{ or } P(t, T) e^{r(t, T) (T - t)} = 1
    \end{equation}

  \subsection{Annuities}

    \begin{definition}[Annuity]
      An \textbf{annuity} is a series of fixed cashflows $C$ at specified times $T_i$ for $i = 1, 2, \ldots, n$. 
    \end{definition}

    \begin{theorem}[Value of Annuity]
      The value $V$ at current time $t \leq T_1$ of an annuity can be calculated by summing the value of the zero coupon bonds a each expiry date $T_i$. 
      \begin{equation}
        V(t, \mathbf{T}) = C \sum_{i=1}^n Z(t, T_i)
      \end{equation}
    \end{theorem}

\section{Stock Markets}

    \begin{definition}[Stocks]
      \textbf{Stocks} are a type of security that represents a share in the ownership of a corporation. That is, owning a stock is equivalent to owning its relative position in the company and its profits, and possibly voting rights. 
    \end{definition}

    But what exactly does it mean to ``own'' a company? To explain this, we can interpret a business to be some sort of entity with input and output cash flows.
    \begin{enumerate}
      \item The majority of the cash flows flowing into the business is the revenue earned from the goods and services that the business provides. 
      \item The majority of the cash flows flowing out of the business are the costs, such as COGS, employment compensation and benefits, operations, lawsuits, taxes, interest on debts, etc.
    \end{enumerate}
    Ideally, the company will have a net profit, or a net positive cash flow, which means that the cash flows in is greater than the cash flows out. All this profit, i.e. this extra money, now goes to the owners of this business through \textbf{dividends} (or may be reinvested into the company). Note that it is not the case that the profits go to the CEO. The CEO is a glorified version of an employee, but still in the end an employee, with an income just like every other employee, albeit a very high one. 
    \begin{center}
      \includegraphics[scale=0.27]{img/Business_Cash_Flow.jpg}
    \end{center}
    Obviously, the owner has a bigger role to play rather than collect profits. They must also decide on things. But since there are usually many owners, these decisions are made through votes in meetings like the annual shareholder meeting. The ownership of a stock really possible rights to earn dividends and possible rights to vote. We will go through the specifics of these powers later. 

  \subsection{Primary Market and Types of Stocks}

    A company gets its funding from debt (e.g. bonds) and equity (stocks). If the prospect of paying interest on debts are not suitable, a company may issue stocks to investors. In other words, the company is selling parts of itself in exchange for capital. The number of shares, type of shares, and the prices for these shares is entirely determined by the seller and buyer. For example, a business may need to raise \$100 million in capital and can choose to issue 10 million shares at \$10 each.

    For early-stage businesses, these are mainly funded by \textbf{venture capital} firms and \textbf{angel investors} (but is not limited to them) through different rounds roughly ordered: seed round, Series A, Series B, Series C, etc. After due diligence, these venture firms, as early investors, may get extra privileges, such as anti-dilution protection, guaranteed board seats, liquidation preferences, priority dividends. Note that upon multiple rounds of issuance, more and more stocks will circulate through more hands, causing \textbf{stock dilution}. No investor would want this and therefore stocks must be issued carefully. At this point, the ownership of a company is held within the hands of private individuals and firms.
    \begin{center}
        \includegraphics[scale=0.25]{img/company_in_private_hands.jpg}
    \end{center}
    One final characteristic to note is the \textbf{nominal value}, or \textbf{par value}, of a company's stock. Like the face value of a bond when issued, the nominal value of the stock is its stated value. It is an arbitrary value assigned for balance sheet purposes when the company is issuing share capital, and is typically \$1 or less. It has little to no bearing on the stock's market price, so no need to worry about this number.

    Perhaps after a few years, the firm has grown to the point where funding on an even larger scale to support even more expansion is needed. Private sources may be too restrictive or small, and so companies may need to tap into the capital of the general public. Thus, they can do a \textbf{public offering}, an issuance of the stock to the general public rather than private entities. This process of an \textbf{initial public offering (IPO)} and the company being listed on a stock exchange is what is referred to as a company "going public." 
    \begin{center}
        \includegraphics[scale=0.27]{img/Going_public.jpg}
    \end{center}
    Investment banks, through underwriting services, facilitate public offerings.
    \begin{center}
        \includegraphics[scale=0.27]{img/Investment_bank_underwriting.jpg}
    \end{center}

    \begin{definition}[Additional Actions on Stocks]
      Throughout the years, companies may do the following: 
      \begin{enumerate}
        \item Additional \textbf{stock issuance} to both public and private investors. 
        \item \textbf{Stock splits} to increase liquidity if the stock price is too high or for other reasons. \textbf{Reverse stock splits} may also be done.
        \item \textbf{Stock buyback} where the company uses its institutional funds to buy back shares from the market to increase its \textbf{treasury shares}. This may be used for anti-dilution purposes or to retain voting control. We can think of these as the opposite as a stock issuance, since treasury shares do not have dividend rights nor voting rights. 
        \item Issue \textbf{restricted stock units (RSUs)} to employees. The grant is restricted because it is subject to a vesting schedule, which can be based on length of employment or performance goals.
      \end{enumerate}
    \end{definition}

    Note that if an entity (individual or organization) has the majority ownership or a \textbf{controlling interest} (at least 50\% in voting rights) of a company, then they have the power to do pretty much whatever they want with the company. 

    \begin{definition}[Types of Circulating Stocks]
      With these, we can organize the number of stocks circulating in different levels, from biggest to smallest:
      \begin{enumerate}
        \item Authorized shares refers to the maximum number of shares that a corporation is legally permitted to issue. Companies don't usually get close to this number due to market conditions, which will be explained later. 
        \item Shares issued refers to the total number of shares issued, including all public shares, private shares, and treasury shares. 
        \item Outstanding shares refer to a company's stock currently held by all shareholders, both public and private shares (including RSUs). It does not include treasury stocks however. 
        \item Floating shares are the shares considered available for the general public. Moreover, the floating percentage represents the portion of outstanding shares that are floating: 
        \[\text{Floating Percentage} = \frac{\text{Floating Shares}}{\text{Shares Outstanding}}\]
      \end{enumerate}
      \begin{center}
          \includegraphics[scale=0.25]{img/Shares_Outstanding.jpg}
      \end{center}
    \end{definition}
    
    \begin{definition}[Properties and Powers of Stocks]
      Stocks may also have the following characteristics below. Generally, we work with common and preferred stocks, but other ones may be labeled using letters (e.g. Class A, Class B stocks) that have certain qualities mentioned below. 
      \begin{enumerate}
        \item \textbf{Voting Power}: Nonvoting shares have no voting power while executive shares can be worth 10 votes. 
        \item \textbf{Payment Priority}: Deferred shares are set as a lower priority for dividends and corporate assets. 
        \item \textbf{Cumulative shares} can accumulate dividend payments that have been deferred due to low profits in the past. 
        \item \textbf{Convertible shares} can be converted into different forms of financial assets (e.g. preferred shares may be convertible into common ones, common shares may be convertible into corporate bonds).
      \end{enumerate}
    \end{definition}

    \begin{definition}[Stock Classes and Types]
      Companies may issue different classes of stocks, each with different rights and privileges. 
      \begin{enumerate}
        \item \textbf{Class A shares} may have more voting rights than Class B shares. 
        \item \textbf{Class B shares} may have more dividend rights than Class A shares. 
        \item \textbf{Class C shares} may have more liquidation rights than Class A shares. 
        \item \textbf{Common stocks} are the most common type of stock. Common stock shareholders receive dividends in proportion to the amount of profit generated each year, and they have voting rights. They are usually the lowest priority over a company's income, after the creditors and preferred stock shareholders. 
        \item \textbf{Preferred stock} are much less common and liquid. Preferred stock shareholders receive fixed dividends and no voting rights. They receive payments after bondholders but before common shareholders. 
      \end{enumerate}
    \end{definition}

  \subsection{Valuation}


  \subsection{Secondary Market}

    \subsubsection{Stock Orders}

      \begin{definition}[Stock Orders]
        The two most common orders one can do is the market order and the limit order. 
        \begin{enumerate}
          \item A \textbf{market order} just buys or sells securities at the market price. This ensures that the transaction will be completed, but the price at which you buy or sell may not be what you want. 
          \item A \textbf{limit order} buys or sells at least at a certain price. It ensures that you get the price you want for a transaction, but it may not be carried out always. 
          \begin{enumerate}
            \item A buy limit order at \$X tells the broker to buy a stock at \$X or lower. 
            \item A sell limit order at \$x tells the broker to sell a stock at \$ or higher. 
          \end{enumerate}
          \item A \textbf{stop loss order} is used to limit an individual's loss or lock in a profit on a stock position. 
          \begin{enumerate}
            \item If an investor buys a stock at \$100, they can make a stop loss at \$95. This means that when the stock price reaches \$95, then it will automatically place a market order to sell the stock (the price may not be fulfilled at exactly \$95 due to volatility). 
            \item If an investor has a short position, on the stock, then they can put a stop loss order at \$105, essentially telling the broker to buy the stock when the price reaches \$105. 
          \end{enumerate}
        \end{enumerate}
      \end{definition}

      In addition to holding a long position, we can \textbf{short sell}, or short, a stock. Given that 100 shares of AAPL are each priced at \$100, we can borrow shares from some investor (probably an institutional investor), sell it on the market for \$100, and hope for the price to drop so we can buy it back. This is pretty symmetric to longing a stock, and many hedge funds use a \textbf{long-short equity strategy} involving a combination of longs and shorts, but there are additional risks. 
      \begin{enumerate}
        \item You must pay additional interest for borrowing stocks. 
        \item Your potential losses is not bounded. 
        \item If you have too much unrealized losses as the stock price goes up, then you may not have enough \textbf{margin} (cash) in your account to even buy back to stock. To prevent this, your broker may issue a \textbf{margin call}, which forces you to buy the stocks back, locking in your loss, unless you add more capital to your account. This margin call may not happen right at the point when your free cash is not enough to buy back all shorted shares. Rather, your brokerage may run some complicated statistical simulations, calculate some confidence interval, and then decide on a threshold that determines whether you will get a margin call. 
      \end{enumerate}
      The third risk is the deadliest, and at worst, you can get \textbf{short-squeezed}. Let's explain how this works. Say you and a bunch of other investors shorted GME. GME prices start going up, and it reaches a point where some investors have to buy back the GME shares due to a margin call. The investors buy back the GME at market price, which adds more orders to the limit order book, causing the price to go even higher. This higher price causes more short-sellers to buy back GME due to additional margin calls, causing GME to go even higher, and so on. This positive feedback loop is extremely deadly, killing off many short sellers. 

      Sometimes, the ethics of short selling are called into question. People who want to ban shorting state that short selling can drive down the stock price, which can be bad because it doesnt spur the economy and reduces optimism in stock markets. Short selling means that stock is being borrowed and sold on the market, increasing supply, and therefore (all else being equal) decreasing price. However, these short sellers keep the stock price more in line with reality, and bad companies are punished by short sellers. 

      Finally, the entities that drive this short selling are \textbf{prime brokers}, which are large financial institutions (usually investment banks) that provide financial management to mainly hedge funds. They act on behalf of the short seller, locating the assets to be sold short for them and providing them with a margin account (which must hold capital to the sum of at least 150\% of the value of the initial transaction). They enable hedge funds to borrow large amounts of stocks from institutional investors to short-sell them and allow them to access large amounts of margin from commercial banks. The prime brokerage makes money through commissions. Prime brokers can also loan capital to investors to increase their leverage, and they also provide financial research and analytics to their clients. 

    \subsubsection{Stock Prices and Limit Order Books}

      Now how is the share price determined? There are two large paradigms for this. The first is the \textbf{fundamental approach}, which attempts to calculate the intrinsic value fo the company by calculating its discounted future cash flows. 
      \[\mathrm{Present Value} = \sum_{n=1}^\infty \frac{\text{Cash Flow}_1}{(1 + R)^n}\]
      However, we will concern ourselves with the second approach: the \textbf{market approach}, which claims that the stock price is determined by supply and demand. This can be seen by looking at the \textbf{limit order book} (LoB), which shows all pending limit orders at the current time. This allows us to see where the prices are concentrated at and how strong the demand is versus the supply. In the diagram below, the right side represent the sell limit orders while the left side represents the buy limit orders. If we submit 50 buy market orders, then the best price is executed. 
      \begin{center}
          \includegraphics[scale=0.3]{img/limit_order_book.png}
      \end{center}
      The market makers profit off of the \textbf{bid-ask spread}, which is the difference in the buy and sell price. If a seller wants to sell at \$99.99 and a buyer wants to buy at \$100.00, then the market maker can buy the stock from the seller for \$99.99 and sell it to the buyer at \$100.00, making a \$0.01 profit. 

  \subsection{Fundamental Stock Valuation}

    We will denote company metrics in bold letters and stock metrics in regular font. 

    \begin{definition}[P/E Ratio]
    Given a company XYZ, say that its earnings (profits) are $\mathbf{E}$ and its market cap $\mathbf{P}$. Then, its price to earnings ratio is 
    \[\frac{\mathbf{P}}{\mathbf{E}}\]
    which is a multiple of how much the company is worth given its earnings. Theoretically, it should be much greater than $1$, since if it had a PE ratio of $1$, then it can earn its entire worth annually, allowing the investor to break even on their investment within a year. 
    \end{definition}

    \begin{definition}[Earnings per Share]
    Given a company XYZ, say that its earnings are $\mathbf{E}$ and its number of shares outstanding $\mathbf{S}$. Then its earnings per share is 
    \[\frac{E}{S}\]
    which is basically telling us how much a company is earning per share. Note that given the stock price $P$ and the EPS, note that the P/E ratio is simply 
    \[\frac{\mathbf{P}}{\mathbf{E}} = \frac{\mathbf{P} / \mathbf{S}}{\mathbf{E} / \mathbf{S}} = \frac{P}{EPS}\]
    \end{definition}

    \begin{definition}[PEG Ratio]
    The PEG ratio is the P/E ratio, but now it accounts for the growth rate of the company earnings. Say that company XYZ has earnings $\mathbf{E}$ this year and $\mathbf{E}_0$ last year. Then, its earnings growth can be calculated as $\mathbf{G} = \mathbf{E}/\mathbf{E}_0 - 1$. Then, its PEG ratio is 
    \[\frac{\mathbf{P}/\mathbf{E}}{\mathbf{G}}\]
    \end{definition}

    \begin{definition}[P/S Ratio]
    The P/S ratio is like the P/E ratio, but now we use the company's sales $\mathbf{S}$, or revenue. This is particularly useful for when the company does not have net profits every year. 
    \[\frac{\mathbf{P}}{\mathbf{S}}\]
    \end{definition}

    \begin{definition}[ROIC]

    \end{definition}

    \begin{definition}[ROA]

    \end{definition}

\section{Stock Trading Strategies}

    Let us introduce some valuation metrics that are used for analyzing a portfolio. We will usually work with some sort of time series of the form $\{X_i\}_{i=0}^n$ (i.e. a discrete-time stochastic process), but if we are only worried about the initial and final price $X_0$ and $X_n$, then we will just mention them. 

    \begin{definition}[Stock Price]
      Given a stock $P$, we can construct a discrete-time stochastic process $\{P_i\}$, where $P_i$ are random variables. 
    \end{definition}

    \begin{definition}[Dividend]
      Given time $i, j$ with $i < j$, the dividend that a stock $P$ pays within time interval $[i, j]$ is the random variable 
      \[D_{[i j]}\]
    \end{definition}

    \begin{definition}[Total Return]
      Given stock price $\{P_i\}$, the amount of money you would have made from time $i$ to $J$ is the random variable 
      \[P_j - P_i + D_{[i, j]}\]
      The \textbf{total return} during that period is defined 
      \[R_{[i, j]} = \frac{P_j - P_i + D}{P_i} = \frac{P_j - P_i}{P_i} + \frac{D_{[i, j]}}{P_i}\]
      which is the price return plus the dividend rate. If this is a single-step return, i.e. $j = i + 1$, then we can write this as shorthand: 
      \[R_{i} = R_{[i-1, i]} = \frac{P_i - P_{i-1}}{P_{i-1}} \approx \ln\bigg( \frac{X_i}{X_{i-1}} \bigg) \text{ for } i = 1, \ldots, n\]
      Sometimes, we refer to \textbf{return} as the total return without the dividend payment. 
    \end{definition}

    Most of the time, we work in \textbf{log returns} as an appropriate approximation of the return. This is mathematically justified since if we fix $P_i$ and assume that $P_{j}$ is close to $P_i$, we can take the Taylor expansion of $\ln(P_j)$ to be 
    \begin{align*}
      \ln(P_j) \approx \ln(P_i) + \frac{1}{P_i} (P_j - P_i) & \implies \frac{P_j - P_i}{P_i} \approx \ln(P_j) - \ln(P_i) = \ln \bigg(\frac{P_j}{P_i} \bigg)
    \end{align*}
    Almost always, we will work with log returns and $R_{[i, j]}$ will denote the log return from time $i$ to $j$. It has its advantages: 
    \begin{enumerate}
      \item It is time-additive: If we have prices $P_i, P_j, P_k$ for $i < j < k$, we can see that 
      \[R_{[i, j]} + R_{[j, k]} = \log \bigg(\frac{P_j}{P_i}\bigg) + \log \bigg( \frac{P_k}{P_j} \bigg) = \log \bigg(\frac{P_k}{P_i} \bigg) = R_{[i, k]}\] 

      \item Symmetricity: It is well known that a stock going down $50\%$ and then going up $50\%$ does not return the stock to its original price, despite it "looking" like it did. This effect is killed when looking at log returns. If $P_j = P_k (1 - k)$ for $0 < k < 1$, then we know that it must scale up by a factor of $\frac{1}{1 - k} \neq 1 + k$ to get the original price. Indeed, it is clearly the case that 
      \[\log(1 - k) + \log(1 + k) = \log(1 - k^2) < 0\]
      and in fact is always less than $0$ (so we always lose money). This is due to the concavity of this function. 
      
      \item It focuses on relative change, which is typically invariant on the underlying price of the stock. 
    \end{enumerate}

    These properties allow us to focus on the returns to calculate our metrics. 

    \begin{definition}[Expected Return]
      The \textbf{expected return} of a stock from time $i$ to $j$ is simply the expected value 
      \[\mathbb{E}[R_{[i, j]}] = \mathbb{E} \bigg[ \frac{P_j - P_i}{P_i} \bigg] \approx \mathbb{E} [ \log(P_j) - \log(P_i) ] \]
    \end{definition}

    \begin{definition}[Stock Volatility]
      Given a stock $P$, its return $R_{[i, j]}$ is a random variable. Its standard deviation is called the \textbf{volatility}. 
      \[\sigma = \sqrt{\mathrm{Var}(R_{[i, j]})}\]
      If we do have data on the stock $\{P_i\}_{i=0}^n$ and its log returns $\{R_i\}_{i=1}^n$, the volatility can be estimated simply by taking the sample standard deviation of this data 
      \[\sigma = \sigma(\{R_i\}_{i=1}^n) = \sqrt{\frac{1}{n} \sum_{i=1}^n (R_i - \mu)^2 } \text{ where } \mu = \frac{1}{n} \sum_{i=1}^n R_i\]
    \end{definition}

    \begin{definition}[Sharpe Ratio]
      The \textbf{Sharpe ratio} is a measurement of risk-adjusted return. Given that you have some stock price with total return $R$ and volatility $\sigma$, the Sharpe ratio is defined as the random variable
      \[S = \frac{R - R_f}{\sigma}\]
      where $R_f$ is risk-free return (e.g. the return you earn on U.S. Treasury bonds), which can be considered as a constant random variable. Sometimes, $R_f$ may not be constant and may be some time-series data itself. 
    \end{definition}

    The Sharpe ratio is one of the most widely used metrics, and it is usually based on an annual horizon. While it is straightforward to compute the annual returns, it is more difficult to compute the annual volatility of a stock because it is sensitive to the time scale (i.e. computing it using daily data will result in much higher volatility than computing in minutely data). In practice, people follow the Square-root-of-Time rule, which takes the daily volatility by a factor of square root of $260$, which is approximately the number of trading days in a year. Therefore, the invariant annual Sharpe ratio is 
    \begin{equation}
      S = \frac{R - R_f}{\sigma \sqrt{260}}
    \end{equation}

  \subsection{Momentum Strategies}

    Momentum strategies can be divided into momentum trending, which bets that the stock price will continue following the trend, and momentum reversing, which bets that the stock price will revert back to some mean. 

    \subsubsection{Moving Averages}

      The simple moving average and the exponential moving averages represent where the stock's price is at average. 

      \begin{definition}[Simple Moving Average]
      Let us have some stock price $\{P_i\}_{i=0}^N$ and fix some lookback parameter $L$. Then, the $L$-period \textbf{simple moving average (SMA)} of the stock is the average of prices of the past $L$ periods, $\{S_i\}_{i=L-1}^N$, where 
      \[S_i = \frac{1}{L} \sum_{j=i-L + 1}^i P_j\]
      \end{definition}

      \begin{definition}[Exponential Moving Average]

      \end{definition}

      We can build momentum strategies by comparing two different MAs of lookback periods $L_1 < L_2$. We can compare the current price to the moving averages, but the current price can be thought of as the $1$-period moving average anyways. The $L_2$-MA is thought of as the long term trend of the stock, while he $L_1$-MA is the short-term trend. The follow are essentially MA strategies. 
      \begin{enumerate}
          \item Momentum Trending: 
          \begin{enumerate}
              \item If the $L_1$-MA is above the $L_2$-MA, then the stock has momentum upwards. $\implies$ Long. 
              \item If $L_1$-MA is below the $L_2$-MA, then the stock has momentum downwards. $\implies$ Short. 
          \end{enumerate}
          
          \item Momentum Reversing: 
          \begin{enumerate}
              \item If the $L_1$-MA is above the $L_2$-MA, then the stock has momentum upwards. $\implies$ Short. 
              \item If $L_1$-MA is below the $L_2$-MA, then the stock has momentum downwards. $\implies$ Long. 
          \end{enumerate}
      \end{enumerate}

    \subsubsection{Bollinger Bands}

      \begin{definition}[Bollinger Bands]
      Let us have some stock price $\{P_i\}_{i=0}^N$ and fix some lookback parameter $L$, along with some $z$-score $Z$. We compute the standard deviation of the prices $P_i$ in the past $L$ periods to get $\{\sigma_i\}_{i=L-1}^N$. 
      \begin{enumerate}
          \item The \textbf{middle band} is defined to be the $L$-period SMA, which we will call 
          \[\{\mathcal{M}_i\}_{i=L-1}^N\] 
          \item The \textbf{upper band} is defined to be the band that is $Z$ standard deviations above the middle band. 
          \[\{\mathcal{U}_i\}_{i=L-1}^N = \{M_i + Z \sigma_i\}_{i=L-1}^N\]
          \item The \textbf{upper band} is defined to be the band that is $Z$ standard deviations below the middle band. 
          \[\{\mathcal{L}_i\}_{i=L-1}^N = \{M_i - Z \sigma_i\}_{i=L-1}^N\]
      \end{enumerate}
      \end{definition}

      Now the algorithm for Bollinger bands is very simple. 
      \begin{enumerate}
          \item In a momentum following case, if $P_i$ crosses below $\mathcal{L}_i$, we short, and if $P_i$ crosses above $\mathcal{U}_i$, we long. 

          \item In a momentum reversing case, if $P_i$ crosses below $\mathcal{L}_i$, we long, and if $P_i$ crosses above $\mathcal{U}_i$, we short. The upper band acts as a resistance level, and the lower band acts as a support level. 
      \end{enumerate}

    \subsubsection{Relative Strength Index}

      The relative strength index indicates the momentum or lack of it. 

      \begin{definition}[Relative Strength Index]
      Let us have some stock price $\{P_i\}_{i=0}^N$. Let us define the period changes as $\{D_i\}_{i=1}^N$ with $D_i = P_i - P_{i-1}$. Then, the total gain and total loss can be defined as 
      \[D_\mathrm{gain} = \sum_{D_i > 0} |P_i - P_{i-1}|, \;\;\; D_{\mathrm{loss}} = \sum_{D_i < 0} |P_i - P_{i-1}|\]
      Then, the \textbf{relative strength index (RSI)} is defined to be 
      \[RSI = 100 \, \frac{D_{\mathrm{gain}}}{D_\mathrm{gain} + D_{\mathrm{loss}}}\]
      which ranges in $[0, 100]$, where $0$ is extremely bearish and $100$ is extremely bullish. Roughly, the RSI being $30$ means that for every 1 increase in a period, there are 2 decreases in other periods. The RSI being $70$ means that for every 1 decrease, there are 2 increases. 
      \end{definition}

      The algorithm is quite simple: 
      \begin{enumerate}
          \item In a momentum following case, if the RSI is below $30$, we short, and if the RSI is above $70$, we long. 
          \item In a momentum reversing case, if the RSI is below $30$, we long, and if the RSI is above $70$, we short. 
      \end{enumerate}

    \subsubsection{Determining Momentum Trending or Reversing}

      Now how can we quantitatively decide whether we should use a momentum trending or reverting strategy? We can measure this behavior of a stock by looking at its autocorrelation. 

      \begin{definition}[Autocorrelation]
      Let us have some stock price $\{P_i\}_{i=0}^N$ and fix some lookback parameter $L$. We construct a lagged version $\{P_i\}_{i=0}^{N-L}$ and compute the correlation of this lagged time series with the original. 
      \[\mathrm{Corr}(\{P_i\}_{i=0}^{N-L}, \{P_i\}_{i = L}^{N})\]
      is called the $L$-period \textbf{autocorrelation} of the stock price. 
      \end{definition}

      We can determine which strategy to use as follows. Let us assume that $L$ is small.  
      \begin{enumerate}
          \item If this autocorrelation is high (near $1$), then this indicates that if the stock moves in a certain direction, it is likely to move in that same direction $L$ periods later. So we should use a momentum following strategy. 
          \item If it is negative (near $-1$), it indicates that if the stock moves in a certain direction, it is likely to move in the opposite direction $L$ periods later. So we should use a momentum reverting strategy. 
      \end{enumerate}
      Trend following stocks tend to be growth stocks, while trend reversing ones are the traditional conservative companies. 

  \subsection{Pairs Trading}

    \subsubsection{Naive Approach}

      Intuitively, pairs trading takes two stocks of very similar companies and bets that they will rise and fall together. If one rises and the other falls, then we can long the one that falls and short the one that rises, ultimately betting on the way that they will converge. To do this, take two sets of stock prices 
      \[\{P_i\}_{i=0}^N \text{ and } \{Q_i\}_{i=0}^N\]
      We first talk about the naive approach, which assumes that if $P$ rises by $5\%$, then $Q$ will also rise by $5\%$: Beginners just look at their common ratios $\{P_i / Q_i\}_{i=0}^N$ and calculate whether this time series diverge or not. Remember that this is not symmetric, so we must log both of them and look at the log of the quotient, i.e. the difference of the logs. 
      \[\Big\{ \log \Big( \frac{P_i}{Q_i} \Big) \Big\}_{i=0}^N = \{ \log(P_i) - \log(Q_i)\}_{i=0}^N \]
      If this time series diverges too much from its average, then we can long and short accordingly. This is another way of saying that the time series of returns are 

      However, this model is too simplistic, since we are limited by the assumption that if $P$ rises by $5\%$, then $Q$ will also rise by the same $5\%$. Companies $P$ and $Q$ may use similar supply chains, but perhaps $P$ is more dependent on it than $Q$. Therefore, if there are supply chain problems, then the effect on $P$ may be say, twice as much as that on $Q$. So, if $P$ goes down by $5\%$, then $Q$ may go down by $2.5\%$. 

    \subsubsection{Sophisticated Pairs Trading}

      Ultimately, our basis assumption is that the returns are linearly correlated in the following relationship. 
      \[\frac{\Delta P}{P} = \beta \frac{\Delta Q}{Q} \iff \log(P_j) - \log(P_i) = \beta \big( \log(Q_j) - \log(Q_i) \big)\]
      This results in the model 
      \[\log(P) = \beta \log(Q) + \alpha + \epsilon\]
      which can be seen to be equivalent because taking the change over time $[i, j]$ on both sides gives 
      \[\Delta \log(P) = \beta \Delta \log(Q) + \Delta \epsilon \iff \frac{\Delta P}{P} = \beta \frac{\Delta Q}{Q} + \Delta\epsilon \]
      So, if we look at
      \[\{\epsilon_i\}_{i=0}^n = \{\log(P_i) - \beta \log(Q_i) - \alpha\}_{i=0}^n \]
      we expect this to be a $0$-mean time series. Let the standard deviation be $\sigma = \sigma(\{\epsilon_i\}_{i=0}^n)$ and let us fix some $Z$-score threshhold. Then 
      \begin{enumerate}
          \item If $\epsilon_i > Z \sigma$, then short $P$ and long $Q$. 
          \item If $\epsilon_i < -Z \sigma$, then long $P$ and short $Q$. 
      \end{enumerate}

    \subsubsection{Long/Short Market Weights}

      But how much should we long or short? Let's look at a couple scenarios: 
      \begin{enumerate}
          \item If $\beta = 1$, and we shorted $\$99$ of $P$ and long $\$1$ of $Q$, then a $5\%$ rise in $P$ would result in $5\%$ rise in $Q$, but since we shorted much more of $P$, we would have a net loss. To mitigate this risk, we should have a weight of $P:Q = 1:1$. 
          \item If $\beta = 10$, and we shorted equally $\$50$ of $P$ and long $\$50$ of $Q$, then a $10\%$ rise in $P$ would result in a $1\%$ rise in $Q$. But since we had equal weights in $P$ and $Q$, this scenario would cause 10 times more losses in $P$ than gains in $Q$, resulting in a net loss. To mitigate this risk, we should have a weight $P:Q = 1:10$. 
      \end{enumerate}
      So, we need to be careful of setting the ratio of our market weights of the stocks $P$ and $Q$: 
      \[\lambda = \frac{\MV_Q}{\MV_P}\]
      Intuitively, we can see that our ratio should be $1: \lambda = 1:\beta$, i.e. $\lambda = \beta$, but let's formalize this with some mathematical derivation. Our portfolio value is 
      \[V = \MV_P + \MV_Q\]
      where $\MV_P = n_P P$ and $\MV_Q = n_Q Q$, where $n_P, n_Q$ are the number of shares of $P, Q$. If we are longing $P$ and shorting $Q$, then $n_P > 0$ and $n_Q < 0$. Then, our change in portfolio value $V$ is 
      \begin{align*}
          \Delta \V & = \Delta \MV_P + \Delta \MV_Q \\
          & = \MV_P \bigg[\frac{\Delta \MV_P}{\MV_P} + \frac{\MV_Q}{\MV_P} \frac{\Delta \MV_Q}{\MV_Q}  \bigg] \\
          & = \MV_P \bigg[ \frac{\Delta P}{P} + \lambda \frac{\Delta Q}{Q} \bigg] \\
          & = \MV_P \bigg[ \beta \frac{\Delta Q}{Q} + \Delta \epsilon + \lambda \frac{\Delta Q}{Q} \bigg] \\
          & = \MV_P \bigg[ (\beta + \lambda) \frac{\Delta Q}{Q} + \Delta \epsilon \bigg] 
      \end{align*}
      Therefore, our change in portfolio value depends on the terms in the last equation. We don't want the change $\Delta Q$ to have any effect on the performance, so we set $\lambda = - \beta$, ultimately resulting in 
      \[\Delta \V = \MV_P \Delta \epsilon\]
      and now our performance is purely dependent on $\Delta \epsilon$. We would like $\Delta \V$ to be positive, so if we are longing $P$, i.e. $\MV_P > 0$, then we want $\Delta \epsilon$ to also be positive. Likewise, if we are shorting $P$, then $\MV_P < 0$ and so we want $\Delta \epsilon < 0$. 

    \subsubsection{Choosing Correct Stocks}

      So, how do we ensure that $\Delta \epsilon$ behaves this way? Remember that $\{\epsilon_i\}$ is $0$-mean time series. However, we want to impose the additional condition that it is \textit{mean-reverting} as well. That is, we don't want it to diverge or oscillate too frequently $\epsilon_i$, since if it did then there is the risk of $\{\log(P_i) - \beta \log(Q_i) - \alpha\}_{i=0}^n$ swinging too widely, resulting in losses. In other words, if $\epsilon_i > 0$, then we want $\Delta \epsilon_{i + 1} = \epsilon_{i+1} - \epsilon_i < 0$, and if $\epsilon_i < 0$, then $\Delta \epsilon_{i+1} > 0$, so that the $\epsilon_i$'s tend to "go back towards $0$." More formally, we can plot all $\epsilon_{i-1}$'s with the $\Delta \epsilon_i$'s, and look at a potentially linear relationship 
      \[\Delta \epsilon_i = \alpha \epsilon_{i-1} + \xi_i\]
      To be mean reverting, we want to test that $\alpha < 0$ with adequate statistical significance, i.e. with p-value $5\%$. By looking at not just the previous $\epsilon_{i-1}$ but also the last $p$ $\epsilon_i$'s we can develop the general linear relationship 
      \[\Delta \epsilon_i = \xi_i + \sum_{j=1}^p \alpha_j \epsilon_{i - j}\]
      This is called the \textbf{Augmented Dickey Fuller (ADF)} test, which tells us whether a time series is mean-reverting or not. 

    \subsubsection{Entry and Exit Points}

\section{Stock Portfolio Analysis}

  We will define a portfolio as a collection of $K$ stocks with prices labeled as a time series data 
  
  \begin{equation}
    \{P_{1,i}\}_{i=1}^N, \{P_{2,i}\}_{i = 1}^N, \ldots, \{P_{N,i}\}_{i=1}^N
  \end{equation}

  with one-step returns $\{R_{k, i}\}_{i = 1}^{N}$ for each $k = 1, \ldots, K$ and total return over the period $[0, N]$ as $R^k$. For simplicity, let us assume that we buy all stocks at time $0$ and hold until time $N$, and so we can consider a one-period market with $\{P_{k, 0}, P_{k, 1}\}$ for $k = 1, \ldots, K$ and corresponding returns 

  \begin{equation}
    \{R_k\} = \{\log(P_{k, 1}) - \log(P_{k, 0})\}
  \end{equation}

  all random variables. 

  \begin{definition}[Market Value of Portfolio]
    The \textbf{market value of a portfolio} $\{P_1, \ldots, P_K\}$ is the random variable 
    \begin{equation}
      V = \sum_{k} \MV_{k} = \sum_k n_{k} P_{k} \text{ which is } \sum_k n_k P_{k, 0} \text{ at time } t = 0
    \end{equation}

    The market weights for each stock is determined as 
    \begin{equation}
      w_{k} = \frac{\MV_{k}}{\V}
    \end{equation}

    where $\sum w_{k} = 1$. We will denote $\mathbf{w} = (w_1, \ldots, w_K)$. If we allow unlimited shorting, then the possible values of of $\mathbf{w}$ are $\{\mathbf{w} \in \mathbb{R}^K \mid \mathbf{w} \cdot \mathbf{1} = 1\}$, but if we only allow all-long positions, then this domain reduces to $\{\mathbf{w} \in \mathbb{R}^K \mid \mathbf{w} \cdot \mathbf{1} = 1, \; 0 \leq w_k \leq 1\}$. 
  \end{definition}

  \begin{definition}[Portfolio Return]
    The \textbf{portfolio return vector} is the random $K$ vector of returns $\mathbf{R} = (R_1, \ldots, R_K)^T$, which may be correlated. We can take its expectation by taking the component expectations over the sample space $w$, or by integrating the component mappings $e _k: \mathbb{R}^K \rightarrow \mathbb{R}$ over the measure $\lambda$ induced by $\mathbf{R}$ 

    \begin{equation}
      \mathbb{E}[\mathbf{R}] \coloneqq \begin{pmatrix} \mathbb{E} [R_1] \\ \vdots \\ \mathbb{E} [R_K] \end{pmatrix} = \begin{pmatrix} \mathbb{E}_\lambda(e_1) \\ \vdots \\ \mathbb{E}_\lambda [e_K] \end{pmatrix}
    \end{equation}

    The \textbf{portfolio return} is defined as the random variable 
    \begin{equation}
      R = \mathbf{w}^T \mathbf{R} = \sum_{k=1}^K w_{k} R_k
    \end{equation}

    i.e. the weighted sum of the individual total returns of the stocks. The \textbf{expected return} of the portfolio is simply 

    \begin{equation}
      \mathbb{E}[R] = \sum_{k=1}^K w_k \mathbb{E}_\lambda [R_k]
    \end{equation}

    We can estimate this by sampling the historical returns of the $k$th stock $R_{k, i}$ of the required length for each stock and then estimating its mean. That is, for each $k$, 
    \begin{equation}
      R_k \approx \hat{R}_k = \frac{1}{n} \sum_{i = 1}^n R_{k, i}
    \end{equation}
  \end{definition}

  \begin{definition}[Portfolio Variance, Volatility]
    The \textbf{covariance matrix} of the portfolio is defined as the covariance matrix of the random vector of returns $\mathbb{R}$. 
    \begin{equation}
      \boldsymbol{\Sigma} = \mathrm{Cov}(\mathbf{R}) \coloneqq \begin{pmatrix} \mathrm{Var}(R_1) & \ldots & \mathrm{Cov}(R_1, R_K) \\ \vdots & \ddots & \vdots \\ \mathrm{Cov}(R_K, R_1) & \ldots & \mathrm{Var}(R_K) \end{pmatrix} 
    \end{equation}
    We can estimate this by sampling the one-period historical returns $R_k$ and computing the sample variance/covariance 
    \begin{equation}
      \sigma_{k_1 k_2} = \mathrm{Cov} \big( \{R_{k_1, i}\}, \{R_{k_2, i}\} \big)
    \end{equation}
    The \textbf{portfolio variance} is simply the variance of $R$. 
    \begin{equation}
      \mathrm{Var}(R) = \mathbf{w}^T \boldsymbol{\Sigma} \mathbf{w} \approx \sum_{k_1, k_2 = 1}^K w_{k_1} w_{k_2} \sigma_{k_1, k_2}
    \end{equation}
    and the \textbf{portfolio volatility} is simply the standard deviation of $R$ 
    \begin{equation}
      \sqrt{\mathrm{Var}(R)}
    \end{equation}
  \end{definition}

  \begin{definition}[Alpha]
    Alpha is a measure of performance. The \textbf{alpha} of a security/portfolio with return $R_p$ compared to some market return $R_m$ is defined as 
    \begin{equation}
      \alpha \coloneqq \mathbb{E}[R_p - R_m] = \mathbb{E}[R_p] - \mathbb{E}[R_m]
    \end{equation}
    If we are given samples of returns $\{R_{p, i}\}$ and $\{R_{m, i}\}$, then we can estimate the $\alpha$ simply as 
    \begin{equation}
      \hat{\alpha} = R_p - R_m = \sum_{k = 1}^{j-i} R_{p, i + k} + \sum_{k=1}^{j-i} R_{m, i + k}
    \end{equation}
  \end{definition}

  \begin{definition}[Beta]
    Beta is a measure of volatility. The \textbf{beta} of a stock compared to some market is defined 
    \begin{equation}
      \beta \coloneqq \rho_{pm} \frac{\sigma_p}{\sigma_m} = \frac{\mathrm{Cov}(R_p, R_m)}{\mathrm{Var}(R_m)}
    \end{equation}
    where $\rho_{pm}$ is the correlation between $R_m$ and $R_f$ and $\sigma$ represents the volatility of returns. If we are given samples of returns $\{R_{p, i}\}$ and $\{R_{m, i}\}$, then we can estimate the beta using the sample correlation and standard deviation: 
    \begin{equation}
      \hat{\beta} = \hat{\rho}_{pm} \frac{\hat{\sigma}_p}{\hat{\sigma}_m} = \rho(\{R_{p, i}\}, \{R_{m, i}\}) \frac{\sigma(\{R_{p, i}\})}{\sigma(\{R_{m, i}\})} 
    \end{equation}
    If a stock has beta value of $1$, then its price activity is strongly correlated with the market (or the benchmark $B_j$). A $\beta < 1$ means that the security is less volatile than the market, and $\beta > 1$ means more volatile. A negative $\beta$ indices that the stock is inversely correlated with the market. 
  \end{definition}

  \subsection{Markowitz Portfolio Theory - Mean Variance Portfolio}

    Consider a one-period market with $K$ independent securities which have identical expected returns and variances, i.e. consider $\{P_{k, 0}, P_{k, 1}\}$ for $k = 1, \ldots, K$. Then, the returns 
    \[R_k = \log(P_{k, 1}) - \log(P_{k, 0})\]
    are random variables such that $\mathbb{E}[R_k] = \mu$ and $\mathrm{Var}(R_k) = \sigma^2$. Let $w_k$ denote the fraction of wealth invested in the $k$th security. Now consider two portfolios 
    \begin{enumerate}
        \item Portfolio A: 100\% invested in stock 1 so that $w_1 = 1$ and $w_k  = 0$ for $k = 2, \ldots, K$ 
        \item Portfolio B: An equi-weighted portfolio so that $w_k = \frac{1}{K}$ for all $k$. 
    \end{enumerate}
    Let $R_A$ and $R_B$ denote the portfolio returns of A and B. Then, we have 
    \begin{align*}
        \mathbb{E}[R_A] & = \mathbb{E}[R_B] = \mu \\
        \mathrm{Var}(R_A) & = w_1 \mathrm{Var}(R_1) = \sigma^2 \\
        \mathrm{Var}(R_B) & = \mathrm{Var} \bigg( \frac{1}{K} \sum_{k=1}^K R_k \bigg) = \frac{1}{K^2} \sum_{k=1}^K \mathrm{Var}(R_k) = \sigma^2 / K
    \end{align*}
    which means that even though the expected returns of portfolios A and B are the same, the volatility of $B$ is much less than that of $A$, making it much more advantageous. We can clearly see that the Sharpe ratio of $A$ is $\mu / \sigma$ (assuming the risk-free return is $0$), but the Sharpe ratio of $B$ is $\mu \sqrt{K}/ \sigma$, which means that as we increase our number of independent stocks $K$, the ratio goes up by a factor of $\sqrt{K}$. 

    \subsubsection{Efficient Frontier without Risk-Free Asset}

      Given a portfolio of stocks $\{P_1, \ldots, P_K\}$ with corresponding return vector $\mathbf{R} = (R_1, \ldots, R_K)$, let us take its expected value $\boldsymbol{\mu} = \mathbb{E}[\mathbf{R}]$ and covariance matrix $\boldsymbol{\Sigma} = \mathrm{Cov}(\mathbf{R})$. Its portfolio return is $R = \mathbf{w}^T \mathbf{R}$. We will assume that we must invest all of our cash into something, which will manifest in the constraint equation $\mathbf{w}^T \mathbf{1} = 1$. 

      \begin{definition}[Efficient Frontier without Risk-Free Asset]
      We would like to construct a risk-return efficient portfolio (by determining the $w_k$'s) so that it has the highest return for the same amount of risk, or the lowest risk for some amount of return. That is, letting $R_{\mathbf{w}}$ be the return of a portfolio with weight $\mathbf{w}$, we would like to find 
      \[\arg \min_{\mathbf{w} \in \mathbb{R}^K} \Var(R_{\mathbf{w}}) = \arg \min_{\mathbf{w} \in \mathbb{R}^K} \frac{1}{2} \mathbf{w}^T \boldsymbol{\Sigma} \mathbf{w}\]
      subject to the constraint equations $\mathbf{w}^T \boldsymbol{\mu} = p$ and $\mathbf{w}^T \mathbf{1} = 1$, where $p$ is our target portfolio returns. The solution to this optimization problem is called the \textbf{Markowitz efficient frontier}, which traces out a hyperbola of the form 
      \[\sigma^2_R = A p^2 + B p + C\]
      if we get rid of the $\boldsymbol{\omega}$ parameter. Here we randomly sample a bunch of $\mathbf{w}$'s from $[0, 1]^K$ (subject to the constraints, of course), construct the return of the portfolio $R_{\mathbf{w}}$, and then plot the points $(\mathbb{E}[R], \Var(R))$. We can see that none of the points ever cross the frontier. 
      \begin{center}
          \includegraphics[scale=0.65]{img/Efficient_Frontier.png}
      \end{center}
      \end{definition}

      Note that this efficient portfolio allows us to have unlimited short positions, which may or may not be realistic. If we wanted to work only with all-long portfolios, then we would impose the nonlinear restrictions 
      \[0 \leq w_k \leq 1 \text{ for } k = 1, \ldots, K\]
      which would need to be solved numerically, possibly using nonlinear models. 

    \subsubsection{Efficient Frontier with Risk-Free Asset}

      If we include a risk-free asset such as cash $C$ with risk-free return $R_f$ to the portfolio $\{P_1, \ldots, P_K\}$, then we slightly modify our equations. By definition, the risk-free asset has volatility $\sigma_0 = 0$ and its weight must be equal to $w_f = 1 - \sum_{i=1}^K w_k$, so we still want to minimize 
      \[\sigma^2 = \frac{1}{2} \mathbf{w}^T \boldsymbol{\Sigma} \mathbf{w}\]
      subject to constraint equations 
      \[R_f \bigg( 1 - \sum_{k=1}^K w_k \bigg) + \sum_{k=0}^K w_k R_k = R\]
      When we allow our portfolio to include the risk-free security, the efficient frontier becomes a straight line that is tangential to the risky efficient frontier and with a $y$-intercept equal to the risk-free rate. 
      \begin{center}
          \includegraphics[scale=0.65]{img/Frontier_with_Risk_Free_Sec.png}
      \end{center}
      We can include other linear portfolio constraints, such as no-borrowing, no-short sales, or certain sector constraints. While analytic solutions are generally no longer available, the resulting problems are easy to solve numerically. 

  \subsection{Capital Asset Pricing Model}

    Let us have some stock $P$ with random variable of return $R_p = R_{P, [i, j]}$ and the market $M$ with random variable of return $R_m = R_{M, [i, j]}$, both within period $[i, j]$. There may be some sort of risk-free return $r_f$ available (e.g. U.S. treasury bonds), so we can observe the returns of these two assets past the risk-free return by considering the joint distribution 

    \begin{equation}
      (R_p - r_f) \times (R_m - r_f)
    \end{equation}

    This may or may not be correlated, but the capital asset pricing model shows that there exists a linear relationship between the expected values of these two distributions. The central insight of the CAPM is that in equilibrium the riskiness of an asset is not measured by the standard deviation of its return but by its beta. 

    \begin{theorem}[CAPM]
      Now let $\overline{R}_m = \mathbb{E}[R_m]$ denote the expected return of the market, and $\overline{R} = \mathbb{E}[R]$ denote the expected return of a security or portfolio. Then, the \textbf{capital asset pricing model (CAPM)} asserts that there exists a linear relationship 
      \begin{equation}
        \overline{R} = r_f + \beta (\overline{R}_m - r_f)
      \end{equation}
      where $r_f$ is the risk-free rate. 
    \end{theorem}
    \begin{proof}
      Let us consider a portfolio of weights $\alpha$ and $1 - \alpha$ on the risky security and market portfolio, respectively. Let $R_\alpha$ denote the random return of this portfolio as a function of $\alpha$. We then have 
      \begin{align*}
          \mathbb{E}[R_\alpha] & = \alpha \overline{R} + (1 - \alpha) \overline{R}_m \\
          \mathrm{Var}(R_\alpha) & = \alpha^2 \mathrm{Var}(R) + (1 - \alpha)^2 \mathrm{Var}(R_m) + 2 \alpha (1 - \alpha) \mathrm{Cov}(R, R_m)
      \end{align*}
      Note that as $\alpha$ varies, the mean and standard deviation $(\mathbb{E}[R_\alpha], \mathrm{Var}(R_\alpha))$ trace out a curve in $\mathbb{R}^2$ that cannot cross the efficient frontier, as shown in the dotted line. 
      \begin{center}
          \includegraphics[scale=0.5]{img/CAPM.png}
      \end{center}
      At $\alpha = 0$, the slope of this curve must equal the slope of the capital market line. The slope of the $\alpha$-curve (where $\sigma(R_\alpha) = \sqrt{\Var(R_\alpha)}$) is 
      \begin{align*}
          \frac{d \mathbb{E}[R_{\alpha}]}{d \sigma(R_\alpha)} \bigg|_{\alpha = 0} & = \frac{d\mathbb{E}[R_\alpha]}{d \alpha} \bigg/ \frac{d \sigma(R_\alpha)}{d \alpha} \bigg|_{\alpha = 0} \\
          & = \frac{\sigma(R_\alpha) (\overline{R} - \overline{R}_m)}{\alpha \sigma(R) - (1 - \alpha) \Var (R_m) + (1 - 2 \alpha) \mathrm{Cov}(R, R_m)} \bigg|_{\alpha = 0} \\
          & = \frac{\sigma(R_m) (\overline{R} - \overline{R}_m)}{-\Var(R_m) + \mathrm{Cov}(R, R_m)}
      \end{align*}
      The slope of the capital market line is $(\overline{R}_m - r_f) / \sigma(R_m)$, and equating the two 
      \begin{equation}
        \frac{\sigma(R_m) (\overline{R} - \overline{R}_m)}{-\Var(R_m) + \mathrm{Cov}(R, R_m)} = \frac{\overline{R}_m - r_f}{\sigma(R_m)}
      \end{equation}
      gives the result. 
    \end{proof}

\section{Forward Contracts} 

    People trade stocks and commodities, but derivatives give more flexibility. To see why, consider the case below. 

    \begin{example}[Apples and Pies]
      Suppose you have an apple orchard and you make pies. You can sell apples and pies at a fixed price, but you can also sell them at a future price. For example, you can sell apples at a future price of \$1 per apple. 
    \end{example}

    \begin{definition}[Derivatives]
      A \textbf{derivative} is a financial instrument whose value depends on (is \textit{derived} from) the value of some other, more basic, underlying variable. Essentially, given some stochastic process $X_t$ describing some variable, the derivative is some function 
      \begin{equation}
        Y_t = g(X_t)
      \end{equation}
      The reason that we say an underlying \textit{variable} is that it includes real assets (e.g. property), financial assets (e.g. stocks), indices (stock, inflation, or housing price index), or an event (e.g. weather, or the amount of rainfall in a given season to hedge against a bad winter). Therefore, these variables can be anything, like the number of people attending a fair, which may be an indicator of the profit of the fair or some catastrophic event, and we can derive value out of that event. Therefore, the variable does not necessarily have to be an asset. 
    \end{definition}

    \begin{example}[Stock Derivative]
      For example, a stock option is derived from the value of the stock, which itself is derived from the value of the underlying company. We will see more specific examples of this later. 
    \end{example}

    \begin{example}[Weather Derivatives]
      A weather derivative can have payout of $g(S_T)$, where 
      \begin{equation}
        g(S_T) = \mathbbm{1} \{S_T > 50\} = \begin{cases} \$1 & \text{ if } S_T > 50 \\ 0 & \text{ if else} \end{cases}
      \end{equation}
      where $S_T$ is the total snowfall in inches during the year up to $T = 1$. Note that both $S_T$ and $g(S_T)$ are random variables whose value is unknown until $T = 1$.
    \end{example}

    \begin{definition}[Payoff Graph, Profit-Loss Diagram]
      To see the dependency between the underlying and the derivative, it helps to plot $g$, known as the \textbf{payoff graph}. The $x$-axis tells you the value of the underlying asset, and the $y$-axis tells you the payoff that a certain buyer or seller will make given the price of the underlying asset. 
      A \textbf{profit-loss diagram} is the same thing but it accounts for the premium paid on a contract. This is important for options since the buyer pays a premium to enter the contract, but doesn't make a difference for forward or future contracts. 
    \end{definition}

    Now we will see the most common type of derivative: the forward contract. 

    \begin{definition}[Forward Contracts]
      \textbf{Forward contracts} are simply contracts between two parties to buy or sell an asset at a future date for a price agreed upon today. 
      \begin{enumerate}
        \item $T$ is the time until delivery, usually in years. This is fixed per contract.
        \item $K$ is the delivery price. This is also fixed per contract. 
        \item $S_t$ is the spot price of the asset at time $t \in [0, T]$.
        \item $V_K (t, T)$ is the value of the contract at current time $t \leq T$ of being long a forward contract with delivery price $K$ and maturity $T$. This will vary over time. 
        \item $P(t, T)$ is the price of the forward contract at time $t$ with maturity $T$. This is the price that you pay to enter the contract.
      \end{enumerate}
    \end{definition}

    \begin{example}[Red Sox]
      If I buy the Boston Red Sox regular season wins at 90, in size one dollar per won, I have a long forward position with delivery price of 90. If the Red Sox wins 100 games I make \$10, and if they have 81 wins I lose \$9. The payout is $S_T - K$ where $S_T$ is the number of wins. 
    \end{example}

  \subsection{Primary Markets and Types of Forwards}

    \begin{example}
      We have a forward contract that agrees to buy/sell an asset for $K = \$100$ in $T=3$ months. Then, the buyer and seller have the following payoff graphs. 
      \begin{figure}[H]
        \centering 
        \includegraphics[scale=0.4]{img/forward_example.png}
        \caption{} 
        \label{fig:foward_example}
      \end{figure}
    \end{example}

    We can see from the following that this is a zero-sum game. Therefore, \textit{no wealth} is created or destroyed in a forward contract, it is only transferred. Since there was no cost to enter the contract, the profit is really a linear relationship between the price of the underlying asset. This is unlike options, where there is a cost to enter since the buyer or seller has the \textit{right}, but not the obligation to buy/sell the asset. This right puts an extra premium on the option that you must pay for. 

    \begin{definition}[Settlement]
      If a contract is \textbf{physically settled}, it means that the buyer actually pays $K$ and receives the asset at time $T$. However, some forwards are \textbf{cash settled}, meaning one simply receives (pays if negative) the amount $S_T - K$ at time $T$. The profit/loss is the same, but there are some key differences. 
      \begin{enumerate}
        \item A cash settled forward has no further exposure to the asset price since you're just receiving the difference in cash. However, a physically settled contract implies that the buyer now owns the asset at $T$, which continues to have exposure to asset price movements. 
      \end{enumerate}
    \end{definition}

  \subsection{Forward Contract Valuation}

    Now let's talk about how you would value a forward. 

    \begin{definition}[Value at Maturity, Payout]
      Since the party that longs the forward contract must pay $K$ at $T$ to buy an asset which is worth $S_T$, the value of the contract at $T$ is 
      \begin{equation}
        V_K (T, T) = S_T - K
      \end{equation}
      This is referred to as the \textbf{value at maturity} or the \textbf{payout} of the contract.
    \end{definition}

    \begin{definition}[Forward Price]
      The \textbf{forward price} $F(t, T)$ at the current time $t \leq T$ is the delivery price $K$ such that 
      \begin{equation}
        V_K (t, T) = 0 \implies V_{F(t, T)} (t, T) = 0 
      \end{equation}
      That is, it is the price that makes the contract have zero value at the current time. By definition, it must be the case that $F(T, T) = S_T$ since to buy an asset at $T$ for the price $F(T, T)$ is the same as buying the asset at the spot price $S_T$. 
    \end{definition}

    Since the forward price tells you what the value of the underlying asset $K$ should be at time $T$ for the contract to have no value, it is a good indicator of the actual value of the contract. When the forward is created, it has no intrinsic value, but as time goes on, the value of the contract changes as the spot price changes.

    \begin{example}
      Suppose that a stock which pays no dividends always has price $100$ and interest rates are always $0$. Then 
      \begin{enumerate}
        \item $F(t, T) = 100$ since if you had the right to buy the stock at $100$ at any time $T$, then this would be the same as buying the stock at the spot market, but it is always $100$ in the spot market. So the value of this contract must be $0$ for all $T$. 
        \item $V_K (t, T) = 100 - K$ since if you have the right to buy the stock at $K$ in time $T$, the spot price will always be worth $100$ so you're really gaining $100 - K$. Therefore the value of this contract must be $100 - K$ for all $T$. 
      \end{enumerate}
    \end{example}

  \subsection{Forward Prices}

    \begin{theorem}[Forward Price of No Income Asset]
      For an asset paying no income (e.g. a stock with no dividends), the forward price is 
      \begin{equation}
        F(t, T) = S_t e^{r (T - t)} \implies F(0, T) = S_0 e^{r T}
      \end{equation} 
    \end{theorem}
    \begin{proof}
      \textbf{Replication}. At current time $t$, let's take two portfolios. 
      \begin{enumerate}
        \item A: Consists of one unit of the underlying stock. 
        \item B: One long forward contract with delivery price $K$, plus $K e^{-r(T - t)}$ of cash. 
      \end{enumerate}
      At time $T$, B can invest the cash at the risk free rate $r$ and get $K$ cash. Then, it executes the forward contract at $K$ to get one stock. Therefore, at time $T$, both portfolios are worth $S_T$ and the values of both portfolios at time $t$ must also be the same. This is called the \textit{replication proof}. 
      \begin{equation}
        S_t = V_K (t, T) + K e^{-r (T - t)} \implies V_K (t, T)= S_t - K e^{-r (T - t)}
      \end{equation}
      We want to find the value of $K$ such that the value of the contract is $0$. Therefore, 
      \begin{equation}
        0 = S_t - K e^{-r (T - t)} \implies K = S_t e^{r (T - t)}
      \end{equation}
    \end{proof}
    \begin{proof}
      \textbf{No Arbitrage}. Another way to prove this is with the \textbf{No-arbitrage principle}. What we do is assume that the forward value is above or below our stated value, and prove that under these assumptions there is an arbitrage opportunity. 
      \begin{enumerate}
        \item Assume that $F(t, T) < S_t e^{r (T - t)}$. Then, you can buy a forward contract at delivery price $K = F(t, T)$ for free. You can also short the underlying stock at $S_t$ and invest the proceeds at the interest rate $r$. At time $T$, you can take your money, which is now worth $S_t e^{r (T - t)}$ and execute the contract by buying one share of the stock for $K = F(t, T)$. This leaves you with no stocks and money of $S_t e^{r (T - t)} - F(t, T) > 0$ by assumption, and you have an arbitrage opportunity.
        \item Assume that $F(t, T) > S_t e^{r (T - t)}$. Then, you can sell a forward contract at delivery price $K = F(t, T)$ for free. I borrow $S_t$ money at the interest rate $r$ and buy a stock. At time $T$, I sell the stock at $F(t, T)$ and also must pay back from who I borrowed at a rate of $S_t e^{r (T - t)}$. Therefore, this leaves me with a net gain of $F(t, T) - S_t e^{r (T - t)} > 0$ by assumption, and I have an arbitrage opportunity.
      \end{enumerate}
      Therefore, since I have an arbitrage opportunity, it must be the case that $F(t, T) = S_t e^{r (T - t)}$.
    \end{proof}

    Intuitively, with the no arbitrage strategy, we can see that if the forward price is too high relative to the stock price $S_t$, we buy the stock now and sell the contract (sell the stock forward at the higher price). If the forward price is too low, then we sell the stock now and buy the contract (buy the stock forward at the cheaper price). 

    \begin{corollary}[Dependence on Forward Price]
      The forward price is only dependent on the current underlying price $S_t$, the interest rate $r$, and the time to maturity $T - t$. Counterintuitively, it does not depend on the growth rate, the standard deviation, or any distributional assumptions of $S_T$. Furthermore, any two assets which pay no income and which have the same spot price $S_t$ will have the same forward price regardless of any views about their future movements. 
    \end{corollary}

  \subsection{Forward Price of Income Assets}

    However, this is unrealistic in a few things. It first does not account for dividends, the cost of storage, or the cost of carry. 

    \begin{theorem}[Forward Price of Income Asset]
      Suppose an asset pays a known amount of income (e.g. dividends, coupons, rent) during the life of the forward contract and the present value at $t$ of the income is $I$. Then, 
      \begin{equation}
        F(t, T) = (S_t - I)e^{r(T - t)}
      \end{equation}
    \end{theorem}
    \begin{proof}
      \textbf{Replication}. Let us have two portfolios. 
      \begin{enumerate}
        \item A: Consists of one unit of the underlying stock. 
        \item B: Consists of one long forward contract with delivery price $K$, plus $K e^{-r(T - t)} + I$ of cash. 
      \end{enumerate}
      Then, B will invest the cash at the risk free rate $r$ and get $K + I e^{r(T - t)}$ cash. Then it uses $K$ to buy the underlying stock, ending up with $I e^{r(T - t)}$ in cash and one unit of stock. A, by owning the stock throughout the span, also receives $I$ of cash (present value), which is equal to $I e^{r(T - t)}$ worth at time $T$. Therefore, the two portfolios are equal at time $T$ and therefore must be equal at time $t$. 
      \begin{equation}
        S_T + I e^{r(T - t)} = V_K (T, T) + K + I e^{r(T - t)} \implies S_t = V_K (t, T) + K e^{-r(T - t)} + I
      \end{equation}
      Therefore, we can solve for the forward price by setting $V_K(t, T) = 0$. 
      \begin{equation}
        S_t = K e^{-r(T - t)} + I \implies F(t, T) = K = (S_t - I) e^{r(T - t)}
      \end{equation}
    \end{proof}

    \begin{proof}
      \textbf{No Arbitrage}. We assume the two scenarios. 
      \begin{enumerate}
        \item $F(t, T) < (S_t - I) e^{r(T - t)}$. Then, we buy the forward contract for free at $K = F(t, T)$ and short the stock at $S_t$. We take the proceeds of the short and invest it at the risk free rate $r$. At time $T$, we buy back the stock at $F(t, T)$, and give back the stock to the lender, and additional pay them the dividends they would have received, which is $I e^{r(T - t)}$. Therefore, our net profit is
          \begin{equation}
            S_t e^{r(T - t)} - F(t, T) - I e^{r(T - t)} > 0
          \end{equation}
        \item $F(t, T) > (S_t - I) e^{r(T - t)}$. Then, we buy the stock at $S_t$ and short the forward contract at $K = F(t, T)$ for free. At time $T$, we get our income $I e^{r(T - t)}$, pay back the lender at $S_t e^{r(T - t)}$, and execute the contract to sell it at $F(t, T)$. Our net profit is 
          \begin{equation}
            F(t, T) + I e^{r(T - t)} - S_t e^{r(T - t)} > 0
          \end{equation}
      \end{enumerate}
      Therefore, we have an arbitrage opportunity in both cases, and therefore it must be the case that $F(t, T) = (S_t - I) e^{r(T - t)}$.
    \end{proof}

    If the stock pays some income at a componded rate, then we have the following result on the forward price. 

    \begin{theorem}
      If the stock pays a continuous dividend yield $q$ (e.g. $q = 0.02$ means that the stock pays $2\%$ of its value in dividends each year), then the forward price is 
      \begin{equation}
        F(t, T) = S_t e^{(r - q)(T - t)}
      \end{equation}
    \end{theorem}

  \subsection{Valuation of Forward Contracts}

    Recall from our example of the asset that pays no income. The replication argument gave 
    \begin{equation}
      S_t = V_K (t, T) + K e^{-r (T - t)}
    \end{equation}
    If we substitute $F(t, T) = S_t e^{r (T -t)}$ (that is, the forward price is the spot price compounded at the risk free rate), then we get
    \begin{equation}
      V_K (t, T) = (F(t, T) - K) e^{-r (T - t)} 
    \end{equation}
    which is the difference between the forward price and the delivery price, discounted back to today. 

    \begin{theorem}[Valuation of Forward Contracts]
      The value of a forward contract on an asset satisfies 
      \begin{equation}
        V_K (t, T) = \big( F(t, T) - K \big) e^{-r(T - t)}
      \end{equation}
    \end{theorem}
    \begin{proof}
      \textbf{No Arbitrage}. We assume the two scenarios.
    \end{proof}

  \subsection{Forward Interest Rates}

\section{Forward Rates and Libor}

  One might want to borrow money at a future time, say from $T_1$ to $T_2$, but they are not sure what the interest rate will be. Therefore, they can buy a forward contract that expires at $T_1$, with an underlying zero coupon bond that has maturity of $T_2$. This essentially allows them to lock in the interest rate $r_{T_1, T_2}$ for a future loan between $T_1$ and $T_2$. This is called the \textit{forward rate}. 

  \begin{definition}[Forward Rate]
    The \textbf{forward rate} at current time $t$ for period $T_1$ to $T_2$ ($t \leq T_1 \leq T_2$) is the interest rate (agreed at $t$) at which one can borrow or lend money from $T_1$ to $T_2$, i.e. the interest rate $r_{T_1, T_2}$. 

    \begin{figure}[H]
      \centering 
      \includegraphics[scale=0.35]{img/forward_zero_rates.png}
      \caption{Letting $r_1$ be the interest rate from $t$ to $T_1$ and $r_2$ be the interest rate from $t$ to $T_2$, we can see that the forward rate $f_{12} = r_{T_1, T_2}$ is the interest rate from $T_1$ to $T_2$.}
      \label{fig:forward_zero_rates}
    \end{figure}
  \end{definition}

  A simple replication argument gives the following result about the forward rate. 

  \begin{theorem}[Forward Rate]
    At time $t$, the fair value of the forward rate $f_{12}$ is given by 
    \begin{equation}
      f_{12} = \frac{(r_2 (T_2 - t) - r_1 (T_1 - t))}{T_2 - T_1}
    \end{equation}
    if the rates of continuously compounded and 
    \begin{equation}
      f_{12} = \bigg( \frac{(1 + r_2)^{T_2 - t}}{(1 + r_1)^{T_1 - t}} \bigg)^{\frac{1}{T_2 - T_1}} - 1 
    \end{equation}
  \end{theorem}
  \begin{proof}
    By the replication argument, consider two portfolios A and B with the same money at time $t$. A first borrows money at the rate $r_1$ and then at the forward rate $f_{12}$, and B borrows at the rate of $r_2$. Then, the value of the two portfolios must be the same at time $T_2$, and so we have 
    \begin{equation}
      e_{r_1(T_1 - t)} e_{f_{12}(T_2 - T_1)} = e_{r_2(T_2 - t)} \implies f_{12} = \frac{(r_2 (T_2 - t) - r_1 (T_1 - t))}{T_2 - T_1}
    \end{equation}
    and if they are discretely compounded we have 
    \begin{equation}
      (1 + r_1)^{T_1 - t} (1 + f_{12})^{T_2 - T_1} = (1 + r_2)^{T_2 - t} \implies f_{12} = \bigg( \frac{(1 + r_2)^{T_2 - t}}{(1 + r_1)^{T_1 - t}} \bigg)^{\frac{1}{T_2 - T_1}} - 1
    \end{equation}
  \end{proof}

  \begin{theorem}[Forward Price of Zero Coupon Bonds]
    For $T_1 \leq T_2$, consider a forward contract with maturity $T_1$ on a ZCB with maturity $T_2$. That is, the underlying asset price is $S_t = Z(t, T_2)$. Then, the forward price, i.e. the price where one can (for no cost) agree to buy a forward contract on the $T_2$-ZCB with a expiry date of $T_1$, is 
    \begin{equation}
      F(t, T_1, T_2) = \frac{Z(t, T_2)}{Z(t, T_1)}
    \end{equation}
  \end{theorem}
  \begin{proof}
    Let 
    \begin{enumerate}
      \item Portfolio A be one ZCB maturing at $T_2$. 
      \item Portfolio B be one long forward with delivery price $K$, and $K$ ZCBs maturing at $T_1$. 
    \end{enumerate}
  \end{proof}

  \begin{corollary}
    Since the value of a ZCB with annually compounded rate is 
    \begin{equation}
      Z(t, T_i) = \frac{1}{(1 + r_i)^{T_i - t}} \text{ for } i = 1, 2
    \end{equation}
    we can substitute to see that the forward price of a ZCB is 
    \begin{equation}
      F(t, T_1, T_2) = \frac{Z(t, T_2)}{Z(t, T_1)} = \frac{(1 + r_1)^{T_1 - t}}{(1 + r_2)^{T_2 - t}} = \frac{1}{(1 + f_{12})^{T_2 - T_1}}
    \end{equation}
  \end{corollary}

\section{Swaps}



\section{Futures}

  Note that when trading futures, it is exchange traded so every trade between a buyer and a seller must go through a clearing house. Let's talk about the properties of a future contract. 

  \begin{definition}[Components of a Future Contract]
    A future contract must specify the following components. 
    \begin{enumerate}
      \item \textbf{Asset}: What is the underlying asset? 

      \item \textbf{Grade}: If the asset is a commodity, we want to specify the quality of the asset allowed at some price. Alternatively, we can talk about the \textbf{expected grade}, which allows for a range of grades depending on the actual grade of the contract.  

      \item \textbf{Contract Size}: The quantity of the asset. How much of it is being traded? The price of the contract shown is usually for one unit of the underlying commodity, so the actual value of the contract is the price times the contract size. These sizes are determined by the exchange (should be large enough for institutions to be interested in but not too big to be unaffordable). Furthermore, the mini contracts are less liquid and have a higher big ask spread. 

      \item \textbf{Delivery Location}: Where is the location? This is also standardized by the exchange, and the buyer must personally deliver the asset from these locations to wherever the asset is needed. 

      \item \textbf{Delivery Time}: The month of contract, which is the month that the commodity will be delivered and is not necessarily the same as the expiration date. 

      \item \textbf{Price Increments}: The minimum price change allowed. 

      \item \textbf{Daily Price Limits}: The maximum price change allowed in a day, and any price change beyond this limit will halt trading (called \textit{limit up} or \textit{limit down}). However, trading can still resume if it goes down. 

      \item \textbf{Position Limits}: The maximum number of contracts that a trader can hold. This is to prevent parties from cornering a market. 
    \end{enumerate}
  \end{definition}

  \begin{example}[Futures Pricing and Size Standards]
    Here is an overview of the pricing and size standards of many futures contracts set by the exchange. 

    \begin{table}[H]
      \centering
      \begin{tabular}{|l|l|l|l|}
      \hline
      \textbf{Underlying}    & \textbf{Size}      & \textbf{Increments}          & \textbf{Ex. Quote} \\ \hline
      Crude Oil (CL)        & 1000 barrels       & $1$ c ($\$10.00$)                 & $\$86.73$\\ \hline
      Crude Oil (CL) Mini   & 500 barrels        & $1$ c ($\$5.00$)                  & $\$86.73$ \\ \hline
      Natural Gas (NG)      & 10,000 mmBtu       & $\sfrac{1}{10}$ c ($\$10.00$)  & $\$2.843$ \\ \hline
      Corn (ZC)             & 5000 Bushels       & $\sfrac{1}{8}$ c ($\$12.50$)   & $400\sfrac{3}{8}$ c \\ \hline
      Wheat (ZW)            & 5000 Bushels       & $\sfrac{1}{8}$ c ($\$12.50$)   & $568\sfrac{1}{4}$ c\\ \hline
      Soybean (ZS)          & 5000 Bushels       & $\sfrac{1}{8}$ c ($\$12.50$)   & $1655\sfrac{1}{2}$ c\\ \hline
      Gold (CS)             & 100 Troy Ounces    & $10$ c ($\$10.00$)                & $\$2349.10$\\ \hline
      Silver (SI) Full      & 5000 Troy Ounces   & $\sfrac{1}{10}$ c ($\$5.00$)   & $\$27.247$ \\ \hline
      Silver (SI) Micro     & 1000 Troy Ounces   & $\sfrac{1}{10}$ c ($\$1.00$)   & \\ \hline
      Copper (NG)           & 25,000 Pounds      & $\sfrac{1}{200}$ c($\$12.50$)  & \\ \hline
      E-Mini S\&P 500       & 50                 & $0.25$ c ($\$12.50$)             & \\ \hline
      E-Mini Nasdaq 100     & 20                 & $0.25$ c ($\$5.00$)              & \\ \hline
      E-Mini Dow            & 5                  & $1$ c ($\$5.00$)                 & \\ \hline 
      E-Mini Russell 2000   & 50                 & $0.10$ c ($\$5.00$)              & \\ \hline
      Micro E-Mini S\&P 500 & 5                  & $0.25$ c ($\$1.25$)              & \\ \hline
      Micro E-Mini Nasdaq 100 & 2                & $0.25$ c ($\$0.50$)              & \\ \hline
      Micro E-Mini Dow      & 0.5                & $1$ c ($\$0.50$)                 & \\ \hline
      Micro E-Mini Russell 2000 & 5              & $0.10$ c ($\$0.50$)              & \\ \hline
      Treasury Bonds        & \$100,000          & $\frac{1}{32}$ c ($\$31.25$)   & \\ \hline
      Treasury Bonds        & \$200,000          & $\frac{1}{32}$ c ($\$62.50$)   & \\ \hline
      \end{tabular}
      \caption{Standards of Futures Contracts}
      \label{tab:futures_standards}
    \end{table}

    \begin{enumerate}
      \item \textbf{Corn} is delivered to Toledo, Ohio. 
      \item \textbf{Oil} (WTI) is delivered to Cushing, Oklahoma.
    \end{enumerate}

    \begin{enumerate}
      \item For oil, natural gas, and copper, the delivery month is the month after the expiration month and delivers on all months. 
      \item For corn, wheat, and soybean, we only deliver on the months of March, May, July, September, and December.
    \end{enumerate}
  \end{example}

  \begin{example}[Harvest and Delivery Standards]
    While most futures deliver throughout the year, for grain (corn, wheat, soybean) futures, they deliver on  the months of March, May, July, September, and December. This is because these are the months of the harvest.
  \end{example}

  It turns out that this discrepancy is important in analyzing the convergence of the future price to the spot price and determining the risk. 

\section{Options}

  \begin{definition}[Long Options]
    An option is a contract that gives the owner the right, but not the obligation, to buy or sell a specific asset (the \textbf{underlying}) at a specific price $K$ (\textbf{strike} or \textbf{exercise price}) at a specific date $T$ (\textbf{expiration date}). When you buy (long) 
    \begin{enumerate}
      \item a \textbf{call option} for $\$X$, then you have the \textit{right} to buy the asset and the seller has the \textit{obligation} to sell. 
      \begin{figure}[H]
        \centering 
        \includegraphics[scale=0.4]{img/call_options.png}
        \caption{Note that the buyer has limited loss and has unlimited gain with the long put, while the seller has limited gain and unlimited loss with the short put.} 
        \label{fig:call_options}
      \end{figure}
      \item a \textbf{put option} for $\$X$, then you have the \textit{right} to sell the asset and the seller has the \textit{obligation} to buy. 
      \begin{figure}[H]
        \centering 
        \includegraphics[scale=0.4]{img/put_options.png}
        \caption{Note that the buyer has limited loss and limited gain, and the seller also has limited loss and limited gain. } 
        \label{fig:put_options}
      \end{figure}
    \end{enumerate}
    There are three types of options. 
    \begin{enumerate}
      \item \textbf{American style} options can be exercised anytime during the life of the option. 
      \item \textbf{European style} options can only be exercised at the expiration date.
      \item \textbf{Bermuda style} options can be exercised at specific dates during the life of the option.
    \end{enumerate}
    This has nothing to do with which continent the options are trading in. It is just a name. Most exchange traded options are American style and most OTC options are European style. 
  \end{definition}

  Note that unlike forwards or futures, the premium changes hands, i.e. the buyer pays the seller to enter the contract.  

\section{Exercises}

  \begin{exercise}[Hull 1.3]
    What is the difference between entering in to a long forward contract when the forward price is $\$50$ and taking a long position in a call option with a strike price of $\$50$? 
  \end{exercise}
  \begin{solution}
    The answer is clear when we look at the payoff graph for each one.  
    \begin{enumerate}
      \item The first difference is that the forward contract renders both parties obligated to buy or sell the underlying at a future time, while the option only gives the seller the obligation to sell, if the buyer requests it.  
      \item The second is that money is paid to enter into the options contract by the buyer, while the forward contract does not. 
      \item Both profits/losses are unlimited in the forward contract, while in the options contract, the buyer has limited loss and the seller has unlimited loss. 
      \item By having the safety of a limited downside for the call options buyer, they get a slightly lower payoff $S_T - C_0$ compared to the forward contract, which is $S_T$. Therefore, the options buyer doesn't actually make a profit until the price of the underlying asset is at least $C_0 + K$. 
      \item If $S_T > K$, we would wish we were taking the forward, and if $S_T < K$, then we wish we were taking the call option.  
    \end{enumerate}
    \begin{figure}[H]
      \centering 
      \includegraphics[scale=0.4]{img/ex1-3.png}
      \caption{The payoff graph for the forward contract and the call option from the buyers side.} 
      \label{fig:ex1-3}
    \end{figure}
  \end{solution}

  \begin{definition}[Pips]
    For the next problem, it helps to know that a \textbf{pip} is 1/100 of a cent. 
  \end{definition}

  \begin{exercise}[Hull 1.5]
    An investor enters into a short forward contract to sell $100,000$ British Pounds for US dollars at an excahnge rate of $1.5$ dollars per pound. How much does the investor gain or lose if the exchange rate at the expiration date is $1.4900$ dollars per pound? What if it is $1.5200$ dollars per pound? 
  \end{exercise}
  \begin{solution}
    Note that we must specify the currency of the profit or loss. It turns out that the payoff will always be in the currency that the investor is selling. The investor is selling the forward, so they are obligated to sell it at $1.5000$ dollars per pound. 
    \begin{enumerate}
      \item If the rate is $1.4900$, then the investor sells the pounds for $150,000$ USD and can buy a little bit more than $100,000$ pounds. In fact, they are making a profit of $100,000 \cdot 0.0100 = 1,000$ dollars.
      \item If the rate is $1.52$, then the investors sells the pounds for $150,000$ USD and can buy a little less than $100,000$ pounds, so they lose $100,000 \cdot 0.0200 = 2,000$ dollars. 
    \end{enumerate}
  \end{solution}


  \begin{exercise}[Hull 1.6]
    A trader enters into a short cotton futures contract when the futures price is 50 cents per pound. The contract is for the delivery of 50,000 pounds. At the end of the contract, the price of cotton is $48.20$ or $51.30$ per pound. What is the trader's gain or loss?
  \end{exercise}
  \begin{solution}
    The trader is selling the cotton, and the buyer is obligated to buy. Therefore, 
    \begin{enumerate}
      \item the trader makes $(50 - 48.20) \cdot 50,000 = 1.8 \cdot 50,000 = 90,000$ cents, or $\$900$ if the price is $48.20$. 
      \item the trader loses $(51.30 - 50) \cdot 50,000 = 1.3 \cdot 50,000 = 65,000$ cents, or $\$650$ if the price is $51.30$.
    \end{enumerate}
  \end{solution}

  \begin{exercise}[Hull 1.16]
    A trader writes (sells) a December put option with a strike price of $\$30$. The price of the option is $\$4$. Under what circumstances does the trader make a profit? 
  \end{exercise}
  \begin{solution}
    Even without a payoff graph, we can see that since I'm selling the option, I'm getting $\$4$. Now, I'm obligated to buy the asset (since it's a put) at $\$30$, and therefore I will profit if the price of the asset is above $\$30$. However, since I already have the cushion of $\$4$, I'm really profiting if the asset price $S_T > 26$. 
    \begin{figure}[H]
      \centering 
      \includegraphics[scale=0.2]{img/ex1-16.png}
      \caption{The payoff graph for the put option from the sellers side.} 
      \label{fig:ex1-16}
    \end{figure}
  \end{solution}

  \begin{exercise}[Hull 1.22]
    I am in a long forward contract and a long put option at the same strike price $K$. What is the payoff of this position at expiration?
  \end{exercise}
  \begin{solution}
    You can simply draw the profit-loss diagram. 
    \begin{figure}[H]
      \centering 
      \includegraphics[scale=0.2]{img/ex1-22.png}
      \caption{The payoff graph for the long forward and long put option at the same strike price.} 
      \label{fig:ex1-22}
    \end{figure}
  \end{solution}

  \begin{exercise}[Hull 1.23]
    We have a \textbf{Index Currency Option Note (ICON)} which states the following: 
    \begin{enumerate}
      \item If the exchange rate USD.JPY $ < 169$, then the bond pays $1000$ USD.
      \item If $84.50 \leq USD.JPY \leq 169$, then the bond pays 
        \begin{equation}
          1000 - \max\bigg\{ 0, 1000 \Big( \frac{169}{S_T} - 1 \Big)\bigg\}
        \end{equation}
      \item If $USD.JPY < 84.50$, then the bond pays nothing. 
    \end{enumerate}
    Show that this ICON is a combination of a bond and two options. 
  \end{exercise}
  \begin{solution}
    This seems a bit easy since we can draw the payoff diagram as such. 
    \begin{figure}[H]
      \centering 
      \includegraphics[scale=0.2]{img/ex1-23-1.png}
      \caption{} 
      \label{fig:ex1-23-1}
    \end{figure}
    However, the underlying asset is shown in yen and the payoff in USD, which complicates calculations. You should rather change the underlying to be USD by changing USD.JPY to JPY.USD. Then, we can do some quick sketches to find that you should have a 
    \begin{enumerate}
      \item Bond at $\$1000$. 
      \item Short call at $1/169$ for $\$1000$. 
      \item Long call at $1/84.50$ for $\$1000$.
    \end{enumerate}
    \begin{figure}[H]
      \centering 
      \includegraphics[scale=0.2]{img/ex1-23-2.png}
      \caption{} 
      \label{fig:ex1-23-2}
    \end{figure}
  \end{solution}


\section{Appendix}

  Futures are mostly cash settled (e.g. look at futures on SP500 index. you can't deliver fractional shares. )

  Margin calls with futures. 

  The difference between the spot and the futures price is called the basis gap/risk. They tend to converge as we approach the expiration date. 

  Order types (market, limit - default, stop), which exists for both long and short futures. 

  Regulations are done by the CFTC (Dodd-Frank Act expands CFTC oversight to OTC markets due to 2008). Accounting (does unrealized gains count as taxable income?) and taxes can be country specific. 

  Talk about derivatives in general 
  - stuff like payoff graphs 
  - definitions of derivatives 

  Forwards \& Futures 
  - how they work, with trading, delivery, quality of goods, settlement (delivery or cash settled). Does delivery actually happen? You must actually request to have it delivered to a warehouse you set up. This could have inventory/delivery fees as well.  
  - basis risk (spot price of asset $A$ is $S_A$, and the futures is $F_A$). (8)
  - hedging strategies with futures (short \& long futures) hedge ratio, with cross-hedging, and minimizing the variance of our position. (is this delta-hedging?) 
  - stock index futures (you need CAPM to evaluate this)




\end{document}

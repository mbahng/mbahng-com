#!/usr/bin/env python3

import os
from pathlib import Path

def update_index(directory):
    """Update the index file for a given directory."""
    dir_path = Path(directory)
    index_file = dir_path / f"index_{directory}.md"
    
    print(f"Updating {index_file}...")
    
    # Check if directory exists
    if not dir_path.exists():
        print(f"Warning: Directory {dir_path} does not exist, skipping...")
        return
    
    # Check for PDFs in the root directory and organize them
    pdf_files = [f for f in dir_path.iterdir() if f.is_file() and f.suffix == '.pdf']
    
    for pdf_file in pdf_files:
        pdf_stem = pdf_file.stem
        paper_dir = dir_path / pdf_stem
        
        # Create subdirectory if it doesn't exist
        if not paper_dir.exists():
            paper_dir.mkdir()
        
        # Move PDF to subdirectory
        new_pdf_path = paper_dir / pdf_file.name
        if not new_pdf_path.exists():
            pdf_file.rename(new_pdf_path)
        
        # Create MD file in subdirectory
        md_file_path = paper_dir / f"{pdf_stem}.md"
        if not md_file_path.exists():
            with open(md_file_path, 'w') as f:
                f.write(f"[[{pdf_file.name}]]\n")
        
        print(f"  Processed: {pdf_stem}")
    
    # Find all .md files in subdirectories
    md_files = ['dataset.md']
    for item in dir_path.iterdir():
        if item.is_dir():
            # Look for .md files in subdirectories
            for md_file in item.iterdir():
                if md_file.is_file() and md_file.suffix == '.md':
                    md_files.append(md_file.name)
    
    # Sort alphabetically
    md_files = sorted(set(md_files))  # Remove duplicates and sort
    
    # Write to index file (create new or overwrite existing)
    with open(index_file, 'w') as f:
        for filename in md_files:
            f.write(f"{filename}\n")
    
    print(f"âœ“ Updated {index_file}")

def main():
    """Main function to update all index files."""
    directories = ["ml", "qc", "bc", "arvr"]
    
    print("Starting index file updates...")
    print("=" * 32)
    
    for directory in directories:
        update_index(directory)
        print()
    
    print("All index files updated successfully!")

if __name__ == "__main__":
    main()

{"version":3,"file":"connect-it.js","sources":["../src/Calc.js","../src/VDOM.js","../src/markers/Marker.js","../src/markers/TriangleMarker.js","../src/markers/CircleMarker.js","../src/markers/SquareMarker.js","../src/Edge.js","../src/SVG.js","../src/markers/refreshMarkers.js","../src/Events.js","../src/ConnectTo.js"],"sourcesContent":["const getCenter = function (div) {\n  return {\n    x: div.offsetLeft + div.offsetWidth / 2,\n    y: div.offsetTop + div.offsetHeight / 2,\n  };\n};\n\nconst getColidPoint = function (edge, destinationLines) {\n  let result;\n  for (const [key, line] of Object.entries(destinationLines)) {\n    if (!result) {\n      const collisionPoint = checkLineCollision(edge, line);\n      if (collisionPoint) {\n        result = collisionPoint;\n      }\n    }\n  }\n  return result;\n};\n\nconst getBorderLines = function (div) {\n  var result = new Object();\n  result.left = {\n    x1: div.offsetLeft,\n    y1: div.offsetTop,\n    x2: div.offsetLeft,\n    y2: div.offsetTop + div.offsetHeight,\n  };\n  result.top = {\n    x1: div.offsetLeft,\n    y1: div.offsetTop,\n    x2: div.offsetLeft + div.offsetWidth,\n    y2: div.offsetTop,\n  };\n  result.bottom = {\n    x1: div.offsetLeft,\n    y1: div.offsetTop + div.offsetHeight,\n    x2: div.offsetLeft + div.offsetWidth,\n    y2: div.offsetTop + div.offsetHeight,\n  };\n  result.right = {\n    x1: div.offsetLeft + div.offsetWidth,\n    y1: div.offsetTop,\n    x2: div.offsetLeft + div.offsetWidth,\n    y2: div.offsetTop + div.offsetHeight,\n  };\n  return result;\n};\nconst checkLineCollision = function (line1, line2) {\n  var uA =\n    ((line2.x2 - line2.x1) * (line1.y1 - line2.y1) -\n      (line2.y2 - line2.y1) * (line1.x1 - line2.x1)) /\n    ((line2.y2 - line2.y1) * (line1.x2 - line1.x1) -\n      (line2.x2 - line2.x1) * (line1.y2 - line1.y1));\n  var uB =\n    ((line1.x2 - line1.x1) * (line1.y1 - line2.y1) -\n      (line1.y2 - line1.y1) * (line1.x1 - line2.x1)) /\n    ((line2.y2 - line2.y1) * (line1.x2 - line1.x1) -\n      (line2.x2 - line2.x1) * (line1.y2 - line1.y1));\n  if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {\n    var intersection = {\n      x: line1.x1 + uA * (line1.x2 - line1.x1),\n      y: line1.y1 + uA * (line1.y2 - line1.y1),\n    };\n    return intersection;\n  }\n  return null;\n};\n\nconst getUniqueId = function () {\n  return new Date().getTime();\n};\n\nconst getLine = (from, to) => {\n  return {\n    x1: from.x,\n    y1: from.y,\n    x2: to.x,\n    y2: to.y,\n  };\n};\n\nconst getEdgeLine = (nodeShape, adjacentShape) => {\n  const centerToCenterLine = getLine(nodeShape.center, adjacentShape.center);\n  const from = getColidPoint(centerToCenterLine, nodeShape.tagLines);\n  const to = getColidPoint(centerToCenterLine, adjacentShape.tagLines);\n  return getLine(from, to);\n};\n\nconst getNodeShape = (node) => {\n  const center = getCenter(node);\n  const tagLines = getBorderLines(node);\n  return {\n    center: center,\n    tagLines: tagLines,\n  };\n};\n\nexport default {\n  getEdgeLine,\n  getNodeShape,\n};\n","import Calc from \"./Calc\";\n\nexport class VDOM {\n  constructor(element) {\n    this.nodes = this.parseNodes(element);\n    this.shapes = this.parseAll(element, \"shapes shape\");\n    const edges = this.parseAll(element, \"edges edge\");\n    this.setShapeIds();\n    this.setNodesAdjecentsAndProps(edges);\n    this.links = this.getLinks();\n  }\n\n  setNodesAdjecentsAndProps(edges) {\n    edges.forEach((edge) => {\n      const from = this.getById(this.nodes, edge.from);\n      const to = this.getById(this.nodes, edge.to);\n      if (\n        to &&\n        from &&\n        (to.center.x !== from.center.x || to.center.y !== from.center.y)\n      ) {\n        from.adjacents.push({\n          to,\n          ...this.getMarkers(edge),\n          color: edge.color,\n          size: edge.size,\n        });\n      }\n    });\n  }\n\n  getLinks() {\n    const edges = [];\n    this.nodes.forEach((node, i) => {\n      node.adjacents.forEach((adjacent) => {\n        const line = Calc.getEdgeLine(node, adjacent.to);\n        edges.push({\n          line,\n          markerStart: adjacent.markerStart?.id + \"Start\",\n          markerEnd: adjacent.markerEnd?.id + \"End\",\n          color: adjacent.color,\n          size: adjacent.size,\n        });\n      });\n    });\n    return edges;\n  }\n\n  parseAll(element, query) {\n    return [...element.querySelectorAll(query)].map(this.parseTag);\n  }\n\n  getById(tags, id) {\n    return tags.filter((tag) => tag.id == id)[0];\n  }\n\n  getByName(tags, name) {\n    return tags.filter((tag) => tag.name == name)[0];\n  }\n\n  getMarkers(edge) {\n    return {\n      markerStart: this.getByName(this.shapes, edge[\"marker-start\"]),\n      markerEnd: this.getByName(this.shapes, edge[\"marker-end\"]),\n    };\n  }\n\n  setShapeIds() {\n    this.shapes.forEach((shape) => (shape.id = shape.name));\n  }\n\n  parseNodes(element) {\n    const nodes = [];\n    element.querySelectorAll(\"nodes *[id]\").forEach((node, i) => {\n      const shape = Calc.getNodeShape(node);\n      nodes.push({\n        id: node.attributes[\"id\"]?.value,\n        ...shape,\n        adjacents: [],\n      });\n    });\n    return nodes;\n  }\n\n  parseTag = (tag) => {\n    const result = {\n      name: tag.tagName,\n      ...this.getAttributes(tag),\n    };\n    if (tag.children.length > 0)\n      result.children = [...tag.children].map(this.parseTag);\n    return result;\n  };\n\n  getAttributes(tag) {\n    const result = [];\n    [...tag.attributes].map((attr) => {\n      result[attr.name] = attr.value;\n    });\n    return result;\n  }\n}\n","export default class Marker {\n  constructor(shape) {\n    this.shape = shape;\n  }\n\n  createMarker() {\n    const marker = document.createElementNS(\n      \"http://www.w3.org/2000/svg\",\n      \"marker\"\n    );\n    marker.setAttribute(\"id\", this.shape.id + this.type);\n    marker.setAttribute(\"orient\", \"auto\");\n    marker.setAttribute(\"refY\", this.refY);\n    marker.setAttribute(\"refX\", this.refX);\n    marker.setAttribute(\"markerHeight\", this.size);\n    marker.setAttribute(\"markerWidth\", this.size);\n    marker.setAttribute(\"viewBox\", `0 0 ${this.size} ${this.size}`);\n    return marker;\n  }\n}\n","import Marker from \"./Marker\";\nexport default class TriangleMarker extends Marker {\n  constructor(shape) {\n    super(shape);\n    this.type = \"Start\";\n    this.size = shape.size ?? 6;\n    this.center = this.size / 2;\n    this.color = shape.color ?? \"black\";\n    this.refX = 0;\n    this.refY = this.center;\n  }\n\n  createMarker() {\n    const marker = super.createMarker();\n    const triangle = document.createElementNS(\n      \"http://www.w3.org/2000/svg\",\n      \"polygon\"\n    );\n    triangle.setAttribute(\n      \"points\",\n      `0,0 0,${this.size} ${this.center},${this.center}`\n    );\n    triangle.setAttribute(\"fill\", this.color);\n    marker.appendChild(triangle);\n    return marker;\n  }\n}\n","import Marker from \"./Marker\";\nexport default class CircleMarker extends Marker {\n  constructor(shape) {\n    super(shape);\n    this.type = \"Start\";\n    this.size = shape.size ?? 6;\n    this.center = this.size / 2;\n    this.color = shape.color ?? \"black\";\n    this.refX = 0;\n    this.refY = this.center;\n  }\n\n  createMarker() {\n    const marker = super.createMarker();\n    const circle = document.createElementNS(\n      \"http://www.w3.org/2000/svg\",\n      \"circle\"\n    );\n    circle.setAttribute(\"cx\", this.center);\n    circle.setAttribute(\"cy\", this.center);\n    circle.setAttribute(\"r\", this.center);\n    circle.setAttribute(\"fill\", this.color);\n    marker.appendChild(circle);\n    return marker;\n  }\n}\n","import Marker from \"./Marker\";\nexport default class SquareMarker extends Marker {\n  constructor(shape) {\n    super(shape);\n    this.type = \"Start\";\n    this.size = shape.size ?? 6;\n    this.center = this.size / 2;\n    this.color = shape.color ?? \"black\";\n    this.refX = 0;\n    this.refY = this.center / 2;\n  }\n\n  createMarker() {\n    const marker = super.createMarker();\n    const square = document.createElementNS(\n      \"http://www.w3.org/2000/svg\",\n      \"rect\"\n    );\n    square.setAttribute(\"x\", \"0\");\n    square.setAttribute(\"y\", \"0\");\n    square.setAttribute(\"width\", this.center);\n    square.setAttribute(\"height\", this.center);\n    square.setAttribute(\"fill\", this.color);\n    marker.appendChild(square);\n    return marker;\n  }\n}\n","export default class Edge {\n  constructor(connectIt) {\n    this.connectIt = connectIt;\n  }\n\n  refreshEdges() {\n    this.graphics = this.resetGraphics();\n    this.connectIt.vdom.links.forEach((edge, i) => {\n      this.graphics.main.appendChild(this.createPath(edge, false));\n      this.graphics.shadows.appendChild(this.createPath(edge, true));\n    });\n  }\n\n  resetGraphics() {\n    const main = this.connectIt.querySelector(\"svg > g.gmain\");\n    const shadows = this.connectIt.querySelector(\"svg > g.gshadow\");\n    main.innerHTML = \"\";\n    shadows.innerHTML = \"\";\n    return { main, shadows };\n  }\n\n  createPath(edge, isShadow) {\n    const path = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n    path.setAttribute(\n      \"d\",\n      `M${Math.round(edge.line.x1)},${Math.round(edge.line.y1)} L${Math.round(\n        edge.line.x2\n      )},${Math.round(edge.line.y2)} `\n    );\n    const edgeSize = edge.size ?? 2;\n    if (isShadow) {\n      path.setAttribute(\"stroke\", \"black\");\n      path.setAttribute(\"opacity\", 0);\n      path.setAttribute(\"stroke-width\", Math.max(edgeSize, 15));\n      path.style = \"pointer-events: auto;\";\n    } else if (!isShadow) {\n      path.setAttribute(\"stroke-width\", edgeSize);\n      if (edge.color) path.setAttribute(\"stroke\", edge.color ?? \"black\");\n      path.setAttribute(\"marker-start\", `url(#${edge.markerStart})`);\n      path.setAttribute(\"marker-end\", `url(#${edge.markerEnd})`);\n    }\n    return path;\n  }\n}\n","import { VDOM } from \"./VDOM\";\nimport refreshMarkers from \"./markers/refreshMarkers\";\nimport Edge from \"./Edge\";\n\nclass SVG {\n  constructor(element) {\n    this.element = element;\n    this.init();\n    this.edge = new Edge(element);\n  }\n\n  init() {\n    this.svg = this.createSVG();\n    this.element.appendChild(this.svg);\n    this.element.defs = this.svg.querySelector(\"defs\");\n  }\n\n  refresh() {\n    const vdom = new VDOM(this.element);\n    if (JSON.stringify(vdom) !== JSON.stringify(this.element.vdom)) {\n      this.element.vdom = vdom;\n      refreshMarkers(this.element);\n      this.edge.refreshEdges();\n      this.resizeSVG();\n    }\n  }\n\n  resizeSVG() {\n    var bbox = this.svg.getBBox();\n    this.svg.setAttribute(\"width\", bbox.x + bbox.width + bbox.x);\n    this.svg.setAttribute(\"height\", bbox.y + bbox.height + bbox.y);\n  }\n\n  createSVG() {\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    this.setSVGProperties(svg);\n    svg.appendChild(this.createDefs());\n    svg.appendChild(this.createGmain());\n    svg.appendChild(this.createGshadow());\n    return svg;\n  }\n\n  createDefs() {\n    const defs = document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\n    return defs;\n  }\n\n  createGmain() {\n    const g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n    g.setAttribute(\"class\", \"gmain\");\n    g.setAttribute(\"fill\", \"none\");\n    g.setAttribute(\"stroke\", \"black\");\n    g.setAttribute(\"stroke-width\", \"2\");\n    return g;\n  }\n\n  createGshadow() {\n    const g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n    g.setAttribute(\"class\", \"gshadow\");\n    return g;\n  }\n\n  setSVGProperties(svg) {\n    svg.setAttribute(\n      \"style\",\n      \"position: absolute; top: 0; left: 0; pointer-events: none;\"\n    );\n  }\n\n  resetSVG(svg) {\n    svg.innerHTML = \"\";\n  }\n}\n\nexport default SVG;\n","import TriangleMarker from \"./TriangleMarker\";\nimport CircleMarker from \"./CircleMarker\";\nimport SquareMarker from \"./SquareMarker\";\n\nconst refreshMarkers = (connectIt) => {\n  connectIt.defs.innerHTML = \"\";\n  connectIt.vdom.shapes.forEach((shape) => {\n    let markerStart = null;\n    let markerEnd = null;\n    switch (shape.type) {\n      case \"triangle\":\n        markerStart = new TriangleMarker(shape);\n        markerEnd = new TriangleMarker(shape);\n        markerEnd.type = \"End\";\n        markerEnd.refX = markerEnd.center;\n        break;\n      case \"circle\":\n        markerStart = new CircleMarker(shape);\n        markerEnd = new CircleMarker(shape);\n        markerEnd.type = \"End\";\n        markerEnd.refX = markerEnd.size;\n        break;\n      case \"square\":\n        markerStart = new SquareMarker(shape);\n        markerEnd = new SquareMarker(shape);\n        markerEnd.type = \"End\";\n        markerEnd.refX = markerEnd.center;\n        break;\n      default:\n        break;\n    }\n    connectIt.defs.appendChild(markerStart.createMarker());\n    connectIt.defs.appendChild(markerEnd.createMarker());\n  });\n};\n\nexport default refreshMarkers;\n","class Events {\n  constructor(element) {\n    this.element = element;\n  }\n\n  refresh = () => {\n    this.element.refresh();\n  };\n\n  refreshOnImagesLoaded() {\n    Promise.all(\n      Array.from(this.element.querySelectorAll(\"img\"))\n        .filter((img) => !img.complete)\n        .map(\n          (img) =>\n            new Promise((resolve) => {\n              img.onload = img.onerror = resolve;\n            })\n        )\n    ).then(this.refresh);\n  }\n\n  refreshOnScroll() {\n    document.addEventListener(\"scroll\", this.refresh);\n    window.addEventListener(\"resize\", this.refresh);\n  }\n\n  disposeRefreshOnScroll() {\n    this.observer.disconnect();\n  }\n\n  refreshOnUserChanges() {\n    this.observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (\n          mutation.target.parent == this.element &&\n          !mutation.target.closest(\"nodes\")\n        )\n          return;\n        this.refresh();\n      });\n    });\n\n    this.observer.observe(document, {\n      attributes: true,\n      childList: true,\n      subtree: true,\n    });\n  }\n\n  disposeRefreshOnUserChanges() {\n    document.removeEventListener(\"scroll\", this.refresh);\n    window.removeEventListener(\"resize\", this.refresh);\n  }\n\n  addMouseEvents() {\n    this.element.addEventListener(\"click\", (e) => {\n      e.target.parentElement.classList.contains(\"gshadow\") &&\n        this.fireHandler(\"click\", e);\n    });\n\n    this.element.addEventListener(\"mouseout\", (e) => {\n      e.target.parentElement.classList.contains(\"gshadow\") &&\n        this.fireHandler(\"mouseout\", e);\n    });\n\n    this.element.addEventListener(\"mouseover\", (e) => {\n      e.target.parentElement.classList.contains(\"gshadow\") &&\n        this.fireHandler(\"mouseover\", e);\n    });\n  }\n\n  fireHandler(eventName, e) {\n    const listenerName =\n      \"onEdges\" + eventName.charAt(0).toUpperCase() + eventName.slice(1);\n    const listener = this.element[listenerName];\n    listener && listener(this.getRelatedPath(e.target));\n    this.refresh();\n    e.stopPropagation();\n  }\n\n  getRelatedPath(shadowPath) {\n    const element = Array.prototype.indexOf.call(\n      shadowPath.parentElement.childNodes,\n      shadowPath\n    );\n    return this.element.querySelector(`edges edge:nth-child(${element + 1})`);\n  }\n}\n\nexport default Events;\n","import SVG from \"./SVG\";\nimport Events from \"./Events\";\n\nclass ConnectTo extends HTMLElement {\n  constructor() {\n    super();\n\n    this.svg = new SVG(this);\n    this.events = new Events(this);\n  }\n\n  connectedCallback() {\n    this.events.refreshOnImagesLoaded();\n    this.events.refreshOnScroll();\n    this.events.refreshOnUserChanges();\n    this.events.addMouseEvents();\n  }\n\n  disconnectedCallback() {\n    this.events.disposeRefreshOnScroll();\n    this.events.disposeRefreshOnUserChanges();\n  }\n\n  refresh() {\n    this.svg.refresh();\n  }\n}\n\ncustomElements.get(\"connect-it\") ||\n  customElements.define(\"connect-it\", ConnectTo);\n"],"names":["getColidPoint","edge","destinationLines","result","key","line","Object","entries","collisionPoint","checkLineCollision","line1","line2","uA","x2","x1","y1","y2","uB","x","y","getLine","from","to","Calc","nodeShape","adjacentShape","centerToCenterLine","center","tagLines","node","div","offsetLeft","offsetWidth","offsetTop","offsetHeight","left","top","bottom","right","getBorderLines","VDOM","constructor","element","this","nodes","parseNodes","shapes","parseAll","edges","setShapeIds","setNodesAdjecentsAndProps","links","getLinks","forEach","getById","adjacents","push","getMarkers","color","size","i","adjacent","markerStart","id","markerEnd","query","querySelectorAll","map","parseTag","tags","filter","tag","getByName","name","shape","attributes","value","tagName","getAttributes","children","length","attr","Marker","createMarker","marker","document","createElementNS","setAttribute","type","refY","refX","TriangleMarker","super","triangle","appendChild","CircleMarker","circle","SquareMarker","square","Edge","connectIt","refreshEdges","graphics","resetGraphics","vdom","main","createPath","shadows","querySelector","innerHTML","isShadow","path","Math","round","edgeSize","max","style","SVG","init","svg","createSVG","defs","refresh","JSON","stringify","resizeSVG","bbox","getBBox","width","height","setSVGProperties","createDefs","createGmain","createGshadow","g","resetSVG","Events","refreshOnImagesLoaded","Promise","all","Array","img","complete","resolve","onload","onerror","then","refreshOnScroll","addEventListener","window","disposeRefreshOnScroll","observer","disconnect","refreshOnUserChanges","MutationObserver","mutations","mutation","target","parent","closest","observe","childList","subtree","disposeRefreshOnUserChanges","removeEventListener","addMouseEvents","e","parentElement","classList","contains","fireHandler","eventName","listenerName","charAt","toUpperCase","slice","listener","getRelatedPath","stopPropagation","shadowPath","prototype","indexOf","call","childNodes","ConnectTo","HTMLElement","events","connectedCallback","disconnectedCallback","customElements","get","define"],"mappings":"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"}